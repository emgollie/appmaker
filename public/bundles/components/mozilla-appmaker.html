<html>
<head>
    <title></title>
</head>
<body>
<polymer-element name="ceci-addform" attributes="resetonsubmit validatecontent dataname datascope" dataname="Items" extends="ceci-element" assetpath="component-addform/">
  <template>
    <style>:host {
  display: block;
  width: 100%;
  box-sizing: border-box;
  background: #EFEFEF;
  padding: 10px;
}

:host h1 {
  font-size: 18px;
  border-bottom: solid 2px #CCC;
  margin-bottom: 10px;
  padding-bottom: 4px;
  text-shadow: 0px 1px 0px white;
}

:host input {
  padding: 5px 3px;
  font-size: 16px;
  box-sizing: border-box;
}

:host input[type=text]{
  width: 90%
}

:host input[type=checkbox]{
  margin-right: 5px;
}

:host label {
  display: block;
}

:host p {
  color: white;
  background: green;
  cursor: pointer;
  padding: 5px 10px;
  display: inline-block;
}

:host .input-wrapper {
  position: relative;
  margin-bottom: 5px;
}

:host input[type=checkbox] {
  margin: 0px;
}

:host .input-wrapper .delete-item {
  display: inline-block;
  background: #BBB;
  -webkit-border-radius: 15px;
  color: white;
  cursor: pointer;
  padding: 3px 7px;
  float: right;
  position: absolute;
  top: calc(50% - 15px);
  right: 0px;
}

:host .button {
  background: green;
  text-align: center;
  padding: 5px 10px;
  color: white;
  cursor: pointer;
  margin: 4px 0;
}

:host #add-input-view {
  background: #DDD;
  border-bottom: solid 1px #BBB;
  padding: 5px;
  padding: 10px;
  -webkit-border-radius: 5px;
  text-align: center;
  margin-bottom: 8px;
}

:host #add-input-view h2 {
  cursor: pointer;
}

:host #add-input-view h2 {
  font-size: 15px;
  margin-bottom: 10px;
  font-weight: normal;
  color: #777;
  line-height: 15px;
}

:host #add-input-view[show=no] h2 {
  margin-bottom: 0;
}

:host #add-input-view[show=no] .input-type {
  display: none;
}

:host .input-type {
  background: #CCC;
  padding: 5px 10px;
  cursor: pointer;
  text-align: center;
  padding: 5px 10px;
  background: #FFF;
  -webkit-border-radius: 4px;
  margin-bottom: 6px;
}

:host .input-type:last-child {
  margin-bottom: 0px;
}

:host .input-types {
  display: block;
}

:host #form-wrapper {
  position: relative;
}

:host #datascope {
  text-align: center;
  padding-bottom: 5px;
}
</style>
    <div id="datascope"></div>
    <div id="add-input-view" show="no">
      <h2 on-click="{{toggleInputMenu}}" id="addInputs">+ Add Inputs</h2>
      <div on-click="{{addInputClick}}" class="input-types">
        <div class="input-type" type="text" id="textInput">Text Input</div>
        <div class="input-type" type="checkbox" id="checkbox">Checkbox</div>
        <div class="input-type" type="range" id="slider">Slider</div>
      </div>
    </div>
    <div id="form-wrapper" class="form"></div>
    <shadow></shadow>
  </template>
  <ceci-definition>
    {
      "thumbnail": "./thumbnail.png",
      "name": "Add Form",
      "description": "Create forms and save data to a database.",
      "broadcasts": {
      },
      "listeners": {
        "saveData": {
          "description": "Submit this form and saves the data a record.",
          "label": "Submit Form"
        },
        "setScope": {
          "description": "Specifies what record to save the data to.",
          "label": "Set Save Scope"
        }
      },
      "attributes": {
        "dataname": {
          "description": "This form will create this item, ie.. 'Cats'",
          "label": "I create...",
          "editable": "text"
        },
        "resetonsubmit": {
          "description": "Clear the form fields after submitting",
          "label": "Reset fields on submit",
          "editable": "boolean"
        },
        "validatecontent": {
          "description": "Prevents the form from submitting without data",
          "label": "Prevent submitting empty form",
          "editable": "boolean"
        }
      }
    }
  </ceci-definition>
  <script>
    Polymer("ceci-addform", {
      ready: function(){
        this.super();
        this.datascope = [];
        var self = this;
        window.addEventListener("CeciAppSaveAs", function(){
          self.saveData();
        });
        this.$.addInputs.innerHTML = this.gettext(this.localName + "/addInputs") || this.$.addInputs.innerHTML;
        this.$.textInput.innerHTML = this.gettext(this.localName + "/textInput") || this.$.textInput.innerHTML;
        this.$.checkbox.innerHTML = this.gettext(this.localName + "/checkbox") || this.$.checkbox.innerHTML;
        this.$.slider.innerHTML = this.gettext(this.localName + "/slider") || this.$.slider.innerHTML;
        this.initialBuildForm = false;
        this.buildForm();
      },
      toggleInputMenu: function(){
        //Toggles the menu at the top of the form used for adding iputs
        var menu = this.shadowRoot.querySelector("#add-input-view");
        var state = menu.getAttribute("show");
        if(state == "yes") {
          menu.setAttribute("show","no");
        } else {
          menu.setAttribute("show","yes");
        }
      },
      setScope : function(e){
        this.datascope = e;
      },
      datascopeChanged : function(){
        var scopeEl = this.shadowRoot.querySelector("#datascope");
        var scopeString = "Adding to ";
        if(this.datascope.length > 0) {
          scopeEl.style.display = "block";
          for(var i = 0; i < this.datascope.length; i++) {
            scopeString = scopeString + this.datascope[i].dataset;
          }
          // scopeEl.innerHTML = scopeString;
        } else {
          scopeEl.style.display = "none";
        }
        scopeEl.style.display = "none";
      },
      addInputClick : function(e){
        var type = e.target.getAttribute("type");
        var inputName = window.prompt(this.gettext(this.localName + "/Name this input") || "Name this input");
        if(inputName){
          this.addInput(type,inputName);
        }
      },
      datanameChanged : function(){
        //handle the case where the dataname is in the process of changing or has changed
        //but doesn't have any input forms yet, so nothing needs to be saved
        this.updateSchema();
      },
      resetForm: function(){
        var fields = this.shadowRoot.querySelectorAll(".form input");
        for (var field in fields) {
          if (fields.hasOwnProperty(field)) {
            var f = fields[field];
            f.value = "";
          }
        }
      },
      _addInputInit: function(type,inputName){
        var self = this;

        var wrapper = document.createElement("div");
        wrapper.classList.add("input-wrapper");

        var input = document.createElement("input");
        input.setAttribute("type",type);
        input.setAttribute("storeName",inputName);

        var label = document.createElement("label");

        var deleteLink = document.createElement("div");
        deleteLink.innerHTML = "X";
        deleteLink.classList.add("delete-item");
        deleteLink.setAttribute("on-click","{{deleteMe}}");
        deleteLink.addEventListener("click",function(e){
          self.deleteItem(e);
        });

        wrapper.appendChild(deleteLink);

        if(type=="checkbox"){
            var labelWrapper = document.createElement("span");
            labelWrapper.innerHTML = inputName;
            label.appendChild(input);
            label.appendChild(labelWrapper);
            wrapper.appendChild(label);
        } else {
            label.innerHTML = inputName;
            wrapper.appendChild(label);
            wrapper.appendChild(input);
        }
        this.shadowRoot.querySelector("#form-wrapper").appendChild(wrapper);
      },
      addInput: function(type,inputName){
        this._addInputInit(type,inputName);
        this.updateSchema();
      },
      enteredView : function(){
        var formWrapper = this.shadowRoot.querySelector("#form-wrapper");
        this.super();
      },
      deleteItem : function(e){
        var item = e.target.parentNode;
        item.parentNode.removeChild(item);
        this.updateSchema();
      },
      buildForm: function(){
        //Builds out the remembered form fields
        var self = this;

        this._checkFirebase(function(ceciApp){
          ceciApp.getFirebaseObject('form-data',"", function(data){
            var db = data || {};

            var fields = db[self.dataname + "_formschema"] || [];
            for (var index in fields) {
              if (fields.hasOwnProperty(index)) {
                var field = fields[index];
                self._addInputInit(field["type"],field["name"]);
              }
            }

            self.initialBuildForm = true;
          });
        });
      },
      _checkFirebase: function(callback){
        var ca = document.querySelector("ceci-app");
        if(!ca){
          var self = this;
          window.addEventListener("CeciDataConnectionLoaded", function(e){
            self.ca = document.querySelector("ceci-app");
            callback(self.ca);
          });
        } else {
          if(ca.firebase){
            callback(ca);
          } else {
            //ceci-app available but firebase not up yet
            window.addEventListener("CeciDataConnectionLoaded", function(e){
              var ca = document.querySelector("ceci-app");
              callback(ca);
            });
          }
        }
      },
      updateSchema : function(){
        if(this.initialBuildForm){
          //Check what inputs there are, and build a schema file of them,
          // so that when the component loads next time, it builds out the correct form
          var schema = [];

          //Builds a schema file based on the fields in the form,
          // should be triggered on load and on add / remove of fields
          var fields = this.shadowRoot.querySelectorAll(".form input");
          for (var field in fields) {
            if (fields.hasOwnProperty(field)) {
              var fieldSchema = {}
              var f = fields[field];
              var name = f.getAttribute("storeName");
              var type = f.getAttribute("type");
              fieldSchema["name"] = name;
              fieldSchema["type"] = type;
              schema.push(fieldSchema);
            }
          }

          // Builds new schema
          var keyname = this.dataname + "_formschema";

          this._checkFirebase(function(ca){
            var that = self;

            ca.getFirebaseObject('form-data',"", function(data){
              var db = data || {};
              db[keyname] = schema;

              var ca = document.querySelector("ceci-app")
              ca.setFirebaseObject('form-data', db);

              //Stoage event!
              var event = new CustomEvent("storage");
              window.dispatchEvent(event);
            });

            // Event! So that data view components know when the schema has changed.
            // Right now the schema depends only on the form inputs?
            // var event = new CustomEvent("formChange");
            // window.dispatchEvent(event);
          });
        }
      },
      saveData : function(){
        var self = this;
        var hasData = true;

        this._checkFirebase(function(ca){
          var that = self;
          ca.getFirebaseObject('form-data',"", function(data){
            var db = data || {};

            var addTo = db;

            for (var i = 0; i < that.datascope.length; i++){
              var scopeItem = that.datascope[i];
              addTo = addTo[scopeItem["dataset"]][scopeItem["index"]];
            }

            if (addTo[that.dataname] === undefined){
              addTo[that.dataname] = [];
            }

            var newData = {};
            var fields = that.shadowRoot.querySelectorAll(".form input");

            for (var field in fields) {
              if (fields.hasOwnProperty(field)) {
                var f = fields[field];
                var name = f.getAttribute("storeName");
                if(f.getAttribute("type") == "checkbox"){
                  var value = f.checked;
                } else {
                  var value = f.value;
                  if(value == ""){
                    hasData = false;
                  }
                }
                newData[name] = value;
              }
            }

            addTo[that.dataname].push(newData);

            if(that.resetonsubmit == "true"){
              that.resetForm();
            }

            if(that.validatecontent == "true" && hasData == false) {

              //Don't submit if
            } else {
              var ca = document.querySelector("ceci-app")
              ca.setFirebaseObject('form-data', db);
              //Stoage event!
              var event = new CustomEvent("storage");
              window.dispatchEvent(event);
            }

          });
        });
      }
    });
  </script>
</polymer-element>

<polymer-element name="ceci-alternating-gate" attributes="" extends="ceci-element" assetpath="component-alternating-gate/">
  <template>
    <style>:host {
  display: block;
  width: 100%;
  padding: 10px;
  background: #555;
  text-align: center;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
}

:host .output-channel {
  padding: 5px 10px;
  background: #999;
  margin: 0 3px;
  display: inline-block;
  border: solid 2px #555;
  -webkit-border-radius: 2px;
  -moz-border-radius: 2px;
  border-radius: 2px;
}

:host .next-up {
  background: white;
  border: solid 2px white;
  font-weight: bold;
}
</style>
    <div id="channels"></div>
    <shadow></shadow>
  </template>
  <ceci-definition>
    {
      "tags": ["alternating-gate", "low-level"],
      "thumbnail": "./thumbnail.png",
      "name": "Alternating Gate",
      "description": "Alternates output between set broadcasts from a single input",
      "broadcasts": {
        "A": {
          "label": "Output A",
          "description": "The first broadcast in the rotation.",
          "default": "green"
        },
        "B": {
          "label": "Output B",
          "description": "The second broadcast in the rotation.",
          "default": "yellow"
        },
        "C": {
          "label": "Output C",
          "description": "The third broadcast in the rotation."
        },
        "D": {
          "label": "Output D",
          "description": "The fourth broadcast in the rotation."
        },
        "E": {
          "label": "Output E",
          "description": "The fifth broadcast in the rotation."
        }
      },
      "listeners": {
        "input": {
          "description": "The input that alternates out the broadcasts.",
          "label": "Input",
          "default": true
        }
      },
      "attributes": {
      }
    }
  </ceci-definition>
  <script>
    Polymer('ceci-alternating-gate', {
      nextBroadcast : "",
      ready: function() {
        this.super();
        this.lastBroadcast = null;
        var self = this;
      },
      domReady : function(){
        var that = this;
        this.addEventListener("channelUpdated",function(){
          this.updateChannels();
          this.updateUI();
        });
        this.updateChannels();
        this.nextBroadcast = this.activeBroadcasts[0];
        this.lastBroadcast = this.activeBroadcasts[0];
        this.updateUI();
      },
      updateUI : function(){
        Array.prototype.forEach.call(this.$.channels.querySelectorAll(".output-channel"), function(c) {
          c.classList.remove("next-up");
        });
        var selected = this.$.channels.querySelector("." + this.nextBroadcast);
        if(selected){
          selected.classList.add("next-up");
        }
      },
      updateChannels: function(){
        var that = this;
        this.activeBroadcasts = [];
        that.$.channels.innerHTML = "";
        Array.prototype.forEach.call(this.querySelectorAll("ceci-broadcast"), function(broadcast) {
          that.activeBroadcasts.push(broadcast.getAttribute("from"));
          var channel = document.createElement("div");
          channel.classList.add("output-channel");
          channel.classList.add(broadcast.getAttribute("from"));
          channel.innerHTML = broadcast.getAttribute("from");
          that.$.channels.appendChild(channel);
        });
      },
      input: function(value) {
        this.broadcast(this.nextBroadcast, value);
        this.nextBroadcast = this.activeBroadcasts.indexOf(this.lastBroadcast) + 1;
        this.nextBroadcast %= this.activeBroadcasts.length;
        this.nextBroadcast = this.activeBroadcasts[this.nextBroadcast];
        this.lastBroadcast = this.nextBroadcast;
        this.updateUI();
      }
    });
  </script>
</polymer-element>

<polymer-element name="ceci-audio" attributes="source speed label value textcolor buttoncolor buttonactivecolor" value="Click" extends="ceci-element" label="Play" textcolor="#ffffff" buttoncolor="#4DB227" buttonactivecolor="#358915" speed="1.0" assetpath="component-audio/">
  <ceci-definition>
    {
      "tags": ["button", "click", "tap"],
      "thumbnail": "./thumbnail.png",
      "description": "Broadcasts a \"click\" when clicked.",
      "name": "Audio",
      "broadcasts": {
        "click": {
          "label": "Click",
          "description": "Occurs when button is clicked.",
          "default": true
        }
      },
      "listeners": {
        "click": {
          "description": "Causes a fake click event to occur.",
          "label": "Click"
        },
        "speed": {
          "description": "Sets the playback rate for the audio clip.",
          "label": "setSpeed"
        }
      },
      "attributes": {
        "source": {
          "label": "Audio source URL.",
          "description": "The URL for the sound clip you want to play",
          "editable": "text",
          "listener": true
        },
        "speed": {
          "label": "Audio playback rate.",
          "description": "1 for normal speed, 2 for twice speed, -1 for reverse, etc.",
          "editable": "number",
          "listener": true
        },
        "label": {
          "label": "Label",
          "description": "Text shown on the button.",
          "editable": "text",
          "listener": true
        },
        "value": {
          "label": "Value",
          "description": "Value sent by the button.",
          "editable": "text",
          "listener": true
        },
        "textcolor": {
          "label": "Text Color",
          "description": "Color of the text on the button's label.",
          "editable": "color",
          "listener": true
        },
        "buttoncolor": {
          "label": "Button Color",
          "description": "Background color of the button.",
          "editable": "color",
          "listener": true
        },
        "buttonactivecolor": {
          "label": "Button Active Color",
          "description": "Background color of the button while it is being clicked or tapped.",
          "editable": "color",
          "listener": true
        }
      }
    }
  </ceci-definition>
  <template>
    <style>:host {
  display: block;
  width: 100%;
}

:host button {
  font-family: "FiraSans", sans-serif;
  cursor: pointer;
  position: relative;
  text-decoration: none;
  outline: none;
  border-top: 1px solid rgba(255,255,255,.3);
  border-bottom: 2px solid rgba(0,0,0,.2);
  background-color: #4DB227;
  text-align: center;
  display: block;
  padding-top: 5px;
  padding-bottom: 3px;
  text-overflow: ellipsis;
  overflow: hidden;
  border-radius: 0.2rem;
  font-weight: 600;
  font-size: 1.8rem;
  line-height: 3.8rem;
  color: #ffffff;
  width: 100%;
  margin: 0;
}

:host audio {
  display: none;
}
</style>
    <button id="button" on-click="{{click}}">{{label}}</button>
    <audio id="clip" src="{{source}}" preload="preload"></audio>
    <shadow></shadow>
  </template>
  <script>
    Polymer('ceci-audio', {
      ready: function () {
        this.super();
        var that = this;
        var mouseUpHandler = function(evt) {
          window.removeEventListener("mouseup", mouseUpHandler);
          that.$.button.style.backgroundColor = that.buttoncolor;
        };
        var mouseDownHandler = function(evt) {
          window.addEventListener("mouseup", mouseUpHandler);
          that.$.button.style.backgroundColor = that.buttonactivecolor;
        };
        this.$.button.addEventListener("mousedown", mouseDownHandler);
      },
      click: function () {
        this.$.clip.play();
        this.broadcast('click', this.getAttribute('value'));
      },
      sourceChanged: function(oldValue, newValue) {
        this.$.clip.src = newValue;
      },
      setSpeed: function(channel, value) {
        this.speedChanged(this.$.clip.playbackRate || 1, value);
      },
      speedChanged: function(oldValue, newValue) {
        try  {
          var f = parseFloat(newValue);
          if (f) {
            this.$.clip.playbackRate = parseFloat(newValue);
          }
        } catch (e) {}
      },
      textcolorChanged: function (oldValue, newValue) {
        this.$.button.style.color = newValue;
      },
      buttoncolorChanged: function (oldValue, newValue) {
        this.$.button.style.backgroundColor = newValue;
      }
    });
  </script>
</polymer-element>

<polymer-element name="ceci-bool" extends="ceci-element" attributes="checkif" checkif="hello" assetpath="component-boolean/">
  <ceci-definition>
    {
      "name": "Boolean",
      "thumbnail": "./thumbnail.png",
      "description": "Checks if a message matches the condition and broadcasts true or false.",
      "broadcasts": {
        "true": {
          "label": "True",
          "description": "The signal matches the condition.",
          "default" : true
        },
        "false": {
          "label": "False",
          "description": "The signal doesn't match the condition."
        }
      },

      "listeners": {
        "incomingMessage": {
          "description": "Increment the total by the increment value",
          "label": "Incoming Message",
          "default" : true
        }
      },
      "attributes": {
        "checkif": {
          "description": "Check if the incoming signal matches this string.",
          "label": "Check If",
          "editable": "Text",
          "default" : true
        }
      }
    }
  </ceci-definition>
  <template>
    <style>:host {
  display: block;
  width: 100%;
  box-sizing: border-box;
  background: #DDD;
  padding: 5px 10px;
  text-align: center;
}

:host span.checkif {
  display: inline-block;
  background-color: white;
  padding: 4px 5px;
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
  border-bottom-right-radius: 5px;
  border-bottom-left-radius: 5px;
  border-style: solid;
  border-color: rgb(204, 204, 204);
  border-width: 1px 1px 2px;
}</style>

    <div class="rule">
      Does the signal equal <span class="checkif">"{{checkif}}"</span> ?
    </div>

    <shadow></shadow>
  </template>
  <tags>starter,math</tags>

    <script>
      Polymer("ceci-bool", {
        ready: function() {
          this.super();
        },
        attached : function(){
          this.super();
        },
        incomingMessage : function(e){
          if (e.toLowerCase === this.checkif.toLowerCase) {
            this.broadcast("true", "true");
          }
          else {
            this.broadcast("false", "false");
          }
        }
      });
    </script>
</polymer-element>

<polymer-element name="ceci-button" attributes="textcolor buttoncolor buttonactivecolor label value" value="Click" extends="ceci-element" label="Click Me" textcolor="#ffffff" buttoncolor="#4DB227" buttonactivecolor="#358915" assetpath="component-button/">
  <ceci-definition>
    {
      "tags": ["button", "click", "tap"],
      "thumbnail": "./thumbnail.png",
      "description": "Broadcasts a \"click\" when clicked.",
      "name": "Button",
      "broadcasts": {
        "click": {
          "label": "Click",
          "description": "Occurs when button is clicked.",
          "default": true
        }
      },
      "listeners": {
        "click": {
          "description": "Causes a fake click event to occur.",
          "label": "Click"
        }
      },
      "attributes": {
        "label": {
          "label": "Label",
          "description": "Text shown on the button.",
          "editable": "text",
          "listener": true
        },
        "value": {
          "label": "Value",
          "description": "Value sent by the button.",
          "editable": "text",
          "listener": true
        },
        "textcolor": {
          "label": "Text Color",
          "description": "Color of the text on the button's label.",
          "editable": "color",
          "listener": true
        },
        "buttoncolor": {
          "label": "Button Color",
          "description": "Background color of the button.",
          "editable": "color",
          "listener": true
        },
        "buttonactivecolor": {
          "label": "Button Active Color",
          "description": "Background color of the button while it is being clicked or tapped.",
          "editable": "color",
          "listener": true
        }
      }
    }
  </ceci-definition>
  <template>
    <style>:host {
  display: block;
  width: 100%;
}

:host button {
  font-family: "FiraSans", sans-serif;
  cursor: pointer;
  position: relative;
  text-decoration: none;
  outline: none;
  border-top: 1px solid rgba(255,255,255,.3);
  border-bottom: 2px solid rgba(0,0,0,.2);
  background-color: #4DB227;
  text-align: center;
  display: block;
  padding-top: 5px;
  padding-bottom: 3px;
  text-overflow: ellipsis;
  overflow: hidden;
  border-radius: 0.2rem;
  font-weight: 600;
  font-size: 1.8rem;
  line-height: 3.8rem;
  color: #ffffff;
  width: 100%;
  margin: 0;
}

:host button {
  border: none;
}

</style>
    <button id="button" on-click="{{click}}">{{label}}</button>
    <shadow></shadow>
  </template>
  <script>
    Polymer('ceci-button', {
      ready: function () {
        this.super();
        var that = this;
        var mouseUpHandler = function(evt) {
          window.removeEventListener("mouseup", mouseUpHandler);
          that.$.button.style.backgroundColor = that.buttoncolor;
        };
        var mouseDownHandler = function(evt) {
          window.addEventListener("mouseup", mouseUpHandler);
          that.$.button.style.backgroundColor = that.buttonactivecolor;
        };
        this.$.button.addEventListener("mousedown", mouseDownHandler);
      },
      click: function () {
        this.broadcast('click', this.getAttribute('value'));
      },
      textcolorChanged: function (oldValue, newValue) {
        this.$.button.style.color = newValue;
      },
      buttoncolorChanged: function (oldValue, newValue) {
        this.$.button.style.backgroundColor = newValue;
      }
    });
  </script>
</polymer-element>

<polymer-element name="ceci-button-with-confirmation" attributes="textcolor buttoncolor buttonactivecolor label confirmationmessage value" extends="ceci-element" label="Click and Confirm Me" textcolor="#ffffff" buttoncolor="#4DB227" buttonactivecolor="#358915" confirmationmessage="Are you sure?" assetpath="component-button-with-confirmation/">
  <template>
    <style>:host {
  display: block;
  width: 100%;
  height: 50px;
}

:host button {
  font-family: "FiraSans", sans-serif;
  cursor: pointer;
  position: relative;
  text-decoration: none;
  outline: none;
  border-top: 1px solid rgba(255,255,255,.3);
  border-bottom: 2px solid rgba(0,0,0,.2);
  background-color: #4DB227;
  text-align: center;
  display: block;
  padding-top: 5px;
  padding-bottom: 3px;
  text-overflow: ellipsis;
  overflow: hidden;
  border-radius: 0.2rem;
  font-weight: 600;
  font-size: 1.8rem;
  line-height: 3.8rem;
  color: #ffffff;
  width: 100%;
  margin: 0;
}

:host button {
  border: none;
}

</style>
    <button id="button" on-click="{{click}}"></button>
    <shadow></shadow>

  </template>
  <ceci-definition>
    {
      "tags": ["button", "click", "tap"],
      "thumbnail": "./thumbnail.png",
      "name": "Button with Confirmation",
      "description": "A button that asks the user to confirm before broadcasting.",
      "broadcasts": {
        "click": {
          "label": "Click",
          "description": "Occurs when button is clicked.",
          "default": true
        },
        "cancelClick": {
          "label": "Cancel Click",
          "description": "Occurs when button is clicked and the user denies the confirmation message."
        }
      },
      "listeners": {
        "click": {
          "description": "Causes a fake click event to occur.",
          "label": "Click"
        }
      },
      "attributes": {
        "label": {
          "label": "Label",
          "description": "Text shown on the button.",
          "editable": "text",
          "listener": true
        },
         "confirmationmessage": {
          "label": "Confirmation Message",
          "description": "Confirmation message that is displayed to the user before executing action.",
          "editable": "text"
        },
        "value": {
          "label": "Value",
          "description": "Value sent by the button.",
          "editable": "text",
          "listener": true,
          "defaultListener": true
        },
        "textcolor": {
          "label": "Text Color",
          "description": "Color of the text on the button's label.",
          "editable": "color",
          "listener": true
        },
        "buttoncolor": {
          "label": "Button Color",
          "description": "Background color of the button.",
          "editable": "color",
          "listener": true
        },
        "buttonactivecolor": {
          "label": "Button Active Color",
          "description": "Background color of the button while it is being clicked or tapped.",
          "editable": "color",
          "listener": true
        }
      }
    }
  </ceci-definition>
  <script>
    Polymer('ceci-button-with-confirmation', {
      ready: function () {
        this.super();

        var that = this;
        this.$.button.addEventListener('mousedown', function (e) {
          var valueBefore = that.buttoncolor;
          if (that.buttonactivecolor) {
            that.$.button.style.backgroundColor = that.buttonactivecolor;
            window.addEventListener('mouseup', function (e) {
              that.$.button.style.backgroundColor = valueBefore;
            }, false);
          }
        }, false);

        this.confirmationmessage = this.getAttribute('confirmationmessage') || "extra default";
      },
      confirmationmessage: (this.confirmationmessage || "default thingy"),
      click: function () {
        if (window.confirm(this.confirmationmessage)) {
            this.broadcast('click', this.getAttribute('value'));
        } else {
            this.broadcast('cancelClick', this.getAttribute('value'));
        }
      },
      labelChanged: function (oldValue, newValue) {
        this.$.button.innerHTML = newValue;
      },
      textcolorChanged: function (oldValue, newValue) {
          this.$.button.style.color = newValue;
      },
      buttoncolorChanged: function (oldValue, newValue) {
        this.$.button.style.backgroundColor = newValue;
      },
      confirmationmessageChanged: function(oldValue, newValue) {
        this.confirmationmessage = newValue;

      }
    });
  </script>
</polymer-element>

<polymer-element name="ceci-camera-button" attributes="textcolor buttoncolor buttonactivecolor label value imageheight imagewidth" extends="ceci-element" label="Enable Camera" textcolor="#ffffff" buttoncolor="#4DB227" buttonactivecolor="#358915" imageheight="160" imagewidth="160" assetpath="component-camera-button/">
  <template>
    <style>:host {
  position: relative;
  display: block;
  width: 100%;
  background: #555;
}

:host .mode-content img {
  width: 80px;
  opacity: .5;
}

/* Pending Mode */

:host .mode-pending .mode-content {
  padding-top: 30px;
}

:host .mode-pending img {
  width: 120px;
}


/* Disabled Mode */

:host .mode-disabled {
  background-position: center 10px;
  background-repeat: no-repeat;
  background-size: 100px;
}

:host .mode-disabled img {
  margin-bottom: 5px;
}

:host .mode-disabled .mode-content {
  padding-top: 30px;
}

:host .mode-disabled img {
  width: 120px;
}

/* File Mode */

:host .mode-file .mode-content {
  padding: 15px 15px 20px 15px;
  min-height: 0;
}

:host .mode-content h2 {
  color: #EEE;
  font-size: 18px;
  padding: 0;
  margin: 0 0 0 0;
}

:host .mode-content p {
  color: #CCC;
  font-size: 16px;
  padding: 0 40px;
  margin: 0 0 20px 0;
}

/* Enabled Mode */

:host .mode-enabled .shutter-bar {
  opacity: 1;
}

/* From File Mode */

:host .mode-file p {
  top: 0;
}

:host .mode {
  text-align: center;
  position: relative;
}

:host .mode-content {
  min-height: 180px;
}

:host  .shutter-bar {
  background: #333;
  padding: 10px 0 12px 0px;
  width: 100%;
  opacity: .2;
  border-top: solid 2px #666;
}

:host .shutter-button {
  margin: 0 auto;
  bottom: 0px;
  background: #DDD;
  height: 35px;
  width: 35px;
  border-radius: 35px;
  background: #4DB227 -webkit-linear-gradient(#DDD,white);
  border: solid 3px #777;
}

:host .mode-enabled .shutter-button {
  cursor: pointer;
}

:host button {
  display: block;
  margin: 0 auto;
  padding: 8px 14px;
  border: 1px solid rgba(0,0,0,.35) ;
  border-bottom: 2px solid rgba(0,0,0,.35);
  border-radius: 0.2rem;
  text-shadow: 0px -1px 0px rgba(0,0,0,.3);
  background: #4DB227 -webkit-linear-gradient(#58c82d,#4DB227);
  color: #ffffff;
  font-family: "FiraSans", sans-serif;
  font-weight: 400;
  font-size: 16px;
  -webkit-border-radius: 3px;
  text-align: center;
  text-decoration: none;
  text-overflow: ellipsis;
  cursor: pointer;
  position: relative;
  outline: rgba(0,0,0,.2) 5px solid;
  overflow: hidden;
  position: realtive;
}

:host button:active {
  background: #4DB227 -webkit-linear-gradient(#4DB227,#58c82d);
  background: #4DB227 -moz-linear-gradient(#4DB227,#58c82d);
  background: #4DB227 linear-gradient(#4DB227,#58c82d);
}

:host #camerainput {
  display: none;
}

:host #videoinput {
  width: 100%;
  display: block;
}

:host #canvasinput {
  display: none;
  height: 200px;
}
</style>

    <div class="mode mode-disabled">
      <div class="mode-content">
        <img src="component-camera-button/images/camera-asleep.png">
        <button id="enable-camera" on-click="{{enableCamera}}">Enable Camera</button>
      </div>
      <div class="shutter-bar">
        <div class="shutter-button"></div>
      </div>
    </div>

    <div class="mode mode-pending">
      <div class="mode-content">
        <img src="component-camera-button/images/arrow-up.png">
        <p>Please allow your device to use your camera.</p>
      </div>
      <div class="shutter-bar">
        <div class="shutter-button"></div>
      </div>
    </div>

    <div class="mode mode-file">
      <div class="mode-content">
        <img src="component-camera-button/images/folder-photo.png">
        <h2>Oops!</h2>
        <p>This device doesn't have a camera but you can...</p>
        <button on-click="{{pickFile}}">Choose an Image File</button>
      </div>
    </div>

    <div class="mode mode-enabled">
      <div class="mode-content">
        <video id="videoinput"></video>
      </div>
      <div class="shutter-bar">
        <div class="shutter-button" on-click="{{takePhoto}}"></div>
      </div>
    </div>

    <canvas id="canvasinput"></canvas>

    <input id="camerainput" type="file" accept="image/*">
    <shadow></shadow>
  </template>
  <ceci-definition>
    {
      "tags": ["tap","camera","photo"],
      "thumbnail": "./thumbnail.png",
      "name": "Camera",
      "description": "Takes a picture with your device camera, or uses an image file camera is not available.",
      "broadcasts": {
        "photo": {
          "label": "Photo",
          "description": "Broadcasts the photo image data.",
          "default": true
        }
      },
      "listeners": {}
    }
  </ceci-definition>
  <script>
    Polymer('ceci-camera-button', {
      ready: function () {
        this.super();
        // do we have getMedia available?
        navigator.getMedia = (navigator.getUserMedia ||
          navigator.webkitGetUserMedia ||
          navigator.mozGetUserMedia ||
          navigator.msGetUserMedia);
      },
      attached : function(){
        if (!navigator.getMedia) {
          this.cameraMode("file");
        } else {
          this.cameraMode("disabled");
        }
        this.super();
      },
      cameraMode : function(mode) {
        var modes = this.shadowRoot.querySelectorAll(".mode");
        modes = Array.prototype.slice.call(modes);
        var fn = function(e) {
          e.style.display = "none";
        };
        modes.forEach(fn);
        this.shadowRoot.querySelector(".mode-" + mode).style.display = "block";
      },
      enableCamera: function() {
        if (navigator.getMedia) {

          this.cameraMode("pending");

          this.streaming = false;
          var that = this;
          var video = this.video = this.$.videoinput;
          var cameraPurpose = {
            video: true,
            audio: false
          };

          var streamHandler = function(stream) {
            that.videoStream = stream;
            if (navigator.mozGetUserMedia) {
              video.mozSrcObject = stream;
            } else {
              var vendorURL = window.URL || window.webkitURL;
              video.src = vendorURL.createObjectURL(stream);
            }
            video.play();
          };

          var errorHandler = function(err) {
            console.log("An error occured! " + err);
            that.cameraMode("disabled");
          };

          navigator.getMedia(cameraPurpose, streamHandler, errorHandler);

          video.addEventListener('canplay', function(ev) {

            if (!that.streaming) {
              that.cameraMode("enabled");
              that.streaming = true;
            }
          }, false);
        }
        // end of ready() code
      },

      takePhoto : function(){
        if ("mozActivity" in navigator) {
          return this.ffosClick();
        }

        var that = this;

        if (navigator.getMedia) {
          var canvas = this.$.canvasinput;
          var video = this.$.videoinput;
          var width = parseInt(this.imagewidth,10);
          var height = video.videoHeight / (video.videoWidth/width);
          canvas.width = width;
          canvas.height = height;
          canvas.getContext('2d').drawImage(video, 0, 0, width, height);
          var data = canvas.toDataURL('image/png');
          console.log("broadcasting");
          this.broadcast('photo', data);

          // Stops the video stream and resets camera
          video.src = "";
          this.videoStream.stop();
          this.cameraMode("disabled");
        }
      },
      ffosClick: function() {
        var activity = new MozActivity({
          // Ask for the "pick" activity
          name: "pick",

          // Provide the data required by the filters of the activity
          data: {
            type: ["image/jpeg", "image/png"]
          }
        });

        var that = this;

        activity.onsuccess = function() {
          var data =  window.URL.createObjectURL(this.result.blob);
          console.log("A picture has been retrieved");
          that.broadcast("photo", data);
        };

        activity.onerror = function() {
          console.log(this.error);
        };
      },
      pickFile : function(){
        var that = this;
        function selectImageFile() {
          var reader = new FileReader();
          var file = that.$.camerainput.files[0];

          reader.onloadend = function() {
            console.log("File", reader.result);
            that.broadcast("photo", reader.result);
          };

          if (file) {
            reader.readAsDataURL(file);
          }
        }

        this.$.camerainput.addEventListener("change", selectImageFile, false);
        this.$.camerainput.click();
      }
    });
  </script>
</polymer-element>

<polymer-element name="ceci-component-canvas" extends="ceci-element" attributes="pensize readonly imageurl" assetpath="component-canvas/">
  <ceci-definition>
    {
      "name": "Canvas",
      "tags": "canvas",
      "thumbnail": "./thumbnail.png",
      "description": "A canvas for drawing and sharing",
      "broadcasts": {
        "imageGenerated": {
          "label": "Image Generated",
          "description": "A portable image URL was generated"
        }
      },
      "listeners": {
        "generateImage": {
          "label": "Generate Image",
          "description": "Generates a portable image URL from the drawing"
        },
        "reset": {
          "label": "Reset",
          "description": "Description for reset"
        }
      },
      "attributes": {
        "pensize": {
          "label": "Pen Size",
          "description": "Width of pen used for drawing",
          "editable": "number",
          "min": 1
        },
        "readonly": {
          "label": "Read Only",
          "description": "Locks/unlocks drawn content",
          "editable": "boolean"
        }
      }
    }
  </ceci-definition>
  <template>
    <style>:host {
  display: block;
  width: 100%;
  height: 400px;
  position: relative;
}

:host canvas {
  width: 100%;
  height: 100%;
  cursor: none;
}

:host #cursor {
  background: #000;
  position: absolute;
  cursor: none;
  pointer-events: none;
}
</style>
    <canvas id="canvas"></canvas>
    <div id="cursor" hidden="true"></div>
    <shadow></shadow>
  </template>
    <script>
      function getMousePositionOffset(e, canvas) {
        if (e.offsetX) {
          return [e.offsetX, e.offsetY];
        }
        else {
          // recover from PointerEvents bug... :/
          var rect = canvas.getBoundingClientRect();
          return [e.clientX - rect.left, e.clientY - rect.top];
        }
      }

      function enableCanvas (canvas, changedCallback) {
        changedCallback = changedCallback || function () {};

        return function (eMouseDown) {
          var canvas = eMouseDown.target;
          var ctx = canvas.getContext('2d');

          var canvasRect = canvas.getBoundingClientRect();
          var startPos = getMousePositionOffset(eMouseDown, canvas);

          ctx.beginPath();
          ctx.moveTo(startPos[0], startPos[1]);

          function onCanvasMouseMove (eMouseMove) {
            var movedPos = getMousePositionOffset(eMouseMove, canvas);
            ctx.lineTo(movedPos[0], movedPos[1]);
            ctx.stroke();
          }

          function onCanvasMouseUp (eMouseUp) {
            canvas.removeEventListener('mousemove', onCanvasMouseMove, false);
            window.removeEventListener('mouseup', onCanvasMouseUp, false);
            ctx.closePath();
            changedCallback();
          }

          canvas.addEventListener('mousemove', onCanvasMouseMove, false);
          window.addEventListener('mouseup', onCanvasMouseUp, false);
        }
      }

      Polymer("ceci-component-canvas", {
        readonly: 'false',
        pensize: 5,
        ready: function() {
          this.super();

          var that = this;
          var cursor = this.$.cursor;
          this.$.canvas.addEventListener('mousemove', function (e) {
            var pos = getMousePositionOffset(e, that.$.canvas);
            cursor.style.left = pos[0] + 'px';
            cursor.style.top = pos[1] + 'px';
          }, false);

          this.$.canvas.addEventListener('mouseenter', function (e) {
            cursor.hidden = false;
          }, false);

          this.$.canvas.addEventListener('mouseleave', function (e) {
            cursor.hidden = true;
          }, false);

          if (this.imageurl && this.imageurl.indexOf('data:image/png;base64,') === 0) {
            var img = new Image();
            var canvas = this.$.canvas;
            img.onload = function () {
              canvas.getContext('2d').drawImage(img,0,0);
            };
            img.src = this.imageurl;
          }

          this.readonlyChanged();
          this.pensizeChanged();
        },
        readonlyChanged: function () {
          var that = this;
          if (this.readonly === 'false') {
            this._onCanvasMouseDown = enableCanvas(this.$.canvas, function () {
              that.imageurl = that.$.canvas.toDataURL();
            });
            this.$.canvas.addEventListener('mousedown', this._onCanvasMouseDown, false);
          }
          else {
            if (this._onCanvasMouseDown) {
              this.$.canvas.removeEventListener('mousedown', this._onCanvasMouseDown, false);
            }
          }
        },
        pensizeChanged: function () {
          var size = parseInt(this.pensize);
          this.$.canvas.getContext('2d').lineWidth = parseInt(this.pensize);
          this.$.cursor.style.width = size + 'px';
          this.$.cursor.style.height = size + 'px';
          this.$.cursor.style.marginTop = -(size/2) + 'px';
          this.$.cursor.style.marginLeft = -(size/2) + 'px';
        },
        generateImage: function () {
          var url = this.$.canvas.toDataURL();
          this.broadcast('imageGenerated', url);
        },
        attached: function () {
          var rect = this.getBoundingClientRect();
          this.$.canvas.width = rect.width;
          this.$.canvas.height = rect.height;
        },
        reset: function() {
          var c = this.$.canvas;
          c.getContext('2d').clearRect(0, 0, c.width, c.height);
          this.broadcast('reset');
        }
      });
    </script>
</polymer-element>

<polymer-element name="ceci-chat-window" attributes="username room" extends="ceci-element" username="Anonymous" room="Mozilla" assetpath="component-chat-window/">
  <ceci-definition>
    {
      "tags": ["chat", "social"],
      "thumbnail": "./thumbnail.png",
      "description": "Start your own chat room.",
      "name": "Chat Window",
      "broadcasts": {
        "messageposted": {
          "label": "Message posted",
          "description": "Occurs when a message is posted in the chatroom.",
          "default": "green"
        }
      },
      "listeners": {
        "clear": {
          "description": "Clear all messages from the chat room",
          "label": "Clear"
        },
        "sendMessage": {
          "default": true,
          "description": "Send a message to the chat room",
          "label": "Send message"
        }
      },
      "attributes": {
        "username": {
          "description": "A username to send messages as",
          "editable": "text",
          "label": "Username",
          "listener": true
        },
        "room": {
          "description": "A chat room to send messages to",
          "editable": "text",
          "label": "Room",
          "listener": true
        }
      }
    }
  </ceci-definition>
  <template>
    <style>:host {
  display: block;
  width: 100%;
  position: relative;
}

:host header {
  background: #333;
  padding: 1.5rem;
  color: white;
}

:host header h1 {
  text-align: left;
  font-size: 1.6rem;
  color: #DDD;
  font-weight: 400;
}

:host header .room-name-wrapper {
  float: right;
  color: #999;
  font-size: 1.4rem;
}

:host ul {
  margin: 0;
  padding: 1rem 1.5rem;
  list-style-type: none;
  border-top: 1px solid #ccc;
  height: 200px;
  top: 7.5rem;
  bottom: 0;
  left: 1rem;
  right: 1rem;
  overflow-y: auto;
  overflow-x: hidden;
}

:host li {
  font-size: 1.2rem;
  font-family: "FiraSans", sans-serif;
  padding: 0.1rem 0rem;
  color: #777;
}

:host li:last-child {
  border: none;
}
</style>
    <header>
      <h1><span id="chatRoom"></span><span class="room-name-wrapper"><span id="roomName"></span> <span class="room-name">{{room}}</span></span></h1>
    </header>
    <ul id="messages"></ul>
    <shadow></shadow>
  </template>
  <script>
    var defaultAppID = 'appmaker';

    Polymer("ceci-chat-window", {
      "chatRoom": "Chat Room",
      "roomName": "Room:",
      ready: function() {
        this.super();

        this.$.chatRoom.innerHTML = this.gettext("ceci-chat-window/chatRoom") || this.chatRoom;
        this.$.roomName.innerHTML = this.gettext("ceci-chat-window/roomName") || this.roomName;

        if (!window.Firebase) {
          var script = document.createElement("script");
          script.onload = this._connect.bind(this);
          script.src = "https://cdn.firebase.com/v0/firebase.js";
          document.head.appendChild(script);
          return;
        }

        this._db = null;
        this._connect();
      },
      clear: function () {
        this._clear();
      },
      usernameChanged: function(oldValue, newValue) {
        if (oldValue && oldValue != 'null'){
          this._sendMessage(
            oldValue + " " +
            this.gettext("ceci-chat-window/is now known as") + " " +
            newValue
          );
        }
      },
      roomChanged: function(oldValue, newValue) {
        this._connect();
      },
      sendMessage: function(event) {
        this._sendMessage(this.username + ": " + event);
      },
      _clear: function() {
        if (!window.Firebase) {
          return;
        }

        this._db.remove();
      },
      _connect: function() {
        if (!window.Firebase) {
          return;
        }
        if(this.__prevQuery) {
          this.__prevQuery.off("child_added");
          this.__prevQuery.off("child_removed");
        }

        this._db = new Firebase("https://appmaker.firebaseio.com/" + defaultAppID + "/chat-window/" + this.room);

        var query = this._db.limit(20);
        query.on("child_added", function(snapshot) {
          var li = document.createElement("li");
          li.textContent = snapshot.val().message;
          li.setAttribute("id", "chat-message-" + snapshot.name().substr(1));
          this.$.messages.appendChild(li);
          this.broadcast('messageposted', snapshot.val().message);
          this.$.messages.scrollTop = this.$.messages.scrollHeight;
        }.bind(this));
        query.on("child_removed", function(snapshot) {
          var messageElement = document.getElementById("chat-message-" + snapshot.name().substr(1));
          if (messageElement) {
            messageElement.remove();
            this.$.messages.scrollTop = this.$.messages.scrollHeight;
          }
        }.bind(this));
        this.__prevQuery = query;
      },
      _sendMessage: function(msg) {
        if (!window.Firebase) {
          return;
        }

        this._db.push({message: msg});
      }
    });
  </script>
</polymer-element>

<polymer-element name="ceci-counter" extends="ceci-element" attributes="unit increment value" assetpath="component-counter/">
  <ceci-definition>
    {
      "name": "Counter",
      "thumbnail": "./thumbnail.png",
      "description": "Listens for a message and counts",
      "broadcasts": {
        "currentCount": {
          "label": "Current Count",
          "description": "Broadcasts the current count."
        }
      },
      "listeners": {
        "countUp": {
          "description": "Increment the total by the increment value",
          "label": "Count Up!",
          "default" : true
        },
        "countDown": {
          "description": "Decrement the total by the increment value",
          "label": "Count Down"
        },
        "resetCount": {
          "description": "Reset the total to 0.",
          "label": "Reset Count"
        }
      },
      "attributes": {
        "unit": {
          "description": "Name for items which are being counted.",
          "label": "Unit",
          "editable": "text"
        },
        "increment": {
          "description": "Count up or down with this number.",
          "label": "Increment By",
          "editable": "number",
          "min" : 1
        }
      }
    }
  </ceci-definition>
  <template>
    <style>:host {
  display: block;
  width: 100%;
}

:host .counter {
  text-align: center;
  font-size: 16px;
  padding: 8px 0px;
  background: #DDD;
  color: #666;
}

:host .counter .count-wrapper {
  display: inline-block;
  background: white;
  padding: 5px 12px;
  border-radius: 5px;
  -webkit-border-radius: 5px;
  border: solid 1px #CCC;
  border-width: 1px 1px 2px 1px;
}
</style>
    <div class="counter">
      <div class="count-wrapper">
        <span class="count">{{value}}</span>
        <span class="count-label">{{displayUnit}}</span>
      </div>
    </div>
    <shadow></shadow>
  </template>
  <tags>starter,math</tags>
    <script>
      Polymer("ceci-counter", {
        ready: function() {
          this.increment = Number(this.increment) || 1;
          this.value = Number(this.value) || 0;
          this.super();
          this.displayUnit = this.unit;
          this.updateUnit();
        },
        value: 0,
        increment: 1,
        unit: 'Sprocket',
        incrementChanged: function(oldValue, newValue) {
          this.increment = Number(this.increment) || 0;
        },
        updateUnit : function(){
          if (this.unit) {
            var unit = this.unit.trim();
            if (unit.length > 0) {

              var pluralChar = "";
              if((Number(this.value) !== 1) && (unit[unit.length - 1] !== 's')){
                pluralChar = "s";
              }

              if(unit[unit.length - 1] === unit[unit.length - 1].toUpperCase()) {
                pluralChar = pluralChar.toUpperCase()
              }
              this.displayUnit = " " + unit + pluralChar;
            }
          }
        },
        unitChanged: function() {
          this.updateUnit();
        },
        valueChanged: function() {
          this.broadcast("currentCount", this.value);
          this.updateUnit();
        },
        countUp: function() {
          this.value = Number(this.value) + Number(this.increment, 10);
        },
        countDown: function() {
          this.value = Number(this.value) - Number(this.increment, 10);
        },
        resetCount: function() {
          this.value = 0;
        }
      });
    </script>
</polymer-element>

<polymer-element name="ceci-cowbell" attributes="source speed label value drumcolor backgroundcolor stickcolor" drumcolor="#FFFFFF" stickcolor="#000000" backgroundcolor="#81ac2d" value="Click" extends="ceci-element" speed="1.0" assetpath="component-cowbell/">
  <ceci-definition>
    {
      "tags": ["button", "click", "tap"],
      "thumbnail": "./thumbnail.png",
      "description": "Broadcasts a \"click\" when clicked.",
      "name": "Cowbell",
      "broadcasts": {
        "click": {
          "label": "Click",
          "description": "Occurs when button is clicked."
        }
      },
      "listeners": {
        "kick": {
          "description": "Causes a fake click event to occur.",
          "label": "Kick",
          "default": true
        },
        "speed": {
          "description": "Sets the playback rate for the audio clip.",
          "label": "setSpeed"
        }
      },
      "attributes": {
        "speed": {
          "label": "Audio playback rate.",
          "description": "1 for normal speed, 2 for twice speed, -1 for reverse, etc.",
          "editable": "number"
        },
        "value": {
          "label": "Value",
          "description": "Value sent by the button.",
          "editable": "text"
        },
        "stickcolor": {
          "label": "Stick Color",
          "editable": "color"
        },
        "backgroundcolor": {
          "label": "Background Color",
          "editable": "color"
        },
        "drumcolor": {
          "label": "Drum Color",
          "description": "Color of the drum.",
          "editable": "color"
        }
      }
    }
  </ceci-definition>
  <template>
    <style>:host {
  display: block;
  width: 100%;
  background: orange;
}

:host #wrapper {
  height: 75px;
  display: block;
  cursor: pointer;
  overflow: hidden;
  width: 100%;
  position: relative;
}

:host #bell {
  position: absolute;
  left: calc(50% - 75px);
  width: 50px;
  top: -20px;
  border-bottom: 100px solid white;
  border-left: 50px solid transparent;
  border-right: 50px solid transparent;
}

:host .hit #bell {
  -webkit-transform: scale(1.2);
}

:host #stick {
  height: 8px;
  width: 120px;
  background: black;
  position: absolute;
  left: 40px;
  top: 20px;
  border-radius: 100px;
  -webkit-transform-origin: left;
}

:host .hit #stick {
  top: 25px;
  -webkit-transform: rotate(15deg);
}

:host .hit #drum {
  top: -15px;
}

:host audio {
  display: none;
}
</style>
    <div id="wrapper" class="off" on-mousedown="{{kickon}}" on-mouseup="{{kickoff}}">
      <div id="bell"></div>
      <!-- <div id="stick"></div> -->
    </div>
    <audio id="kicksound" src="component-cowbell/sounds/sound.mp3" preload="preload"></audio>
    <shadow></shadow>
  </template>
  <script>
    Polymer('ceci-cowbell', {
      ready: function () {
        this.super();
        var that = this;
      },
      kickon: function () {
        this.$.kicksound.pause();
        this.$.kicksound.currentTime = 0;
        this.$.kicksound.play();
        this.$.wrapper.classList.add("hit");
      },
      kick : function(){
        this.kickon();
        var that = this;
        window.setTimeout(function(){
          that.kickoff();
        },100)
      },
      kickoff : function(){
        this.$.wrapper.classList.remove("hit");
      },
      snare: function () {
        this.$.snare.pause();
        this.$.snare.currentTime = 0;
        this.$.snare.play();
      },
      sourceChanged: function(oldValue, newValue) {
        this.$.clip.src = newValue;
      },
      setSpeed: function(channel, value) {
        this.speedChanged(this.$.snare.playbackRate || 1, value);
        this.speedChanged(this.$.kick.playbackRate || 1, value);
      },
      speedChanged: function(oldValue, newValue) {
        try  {
          var f = parseFloat(newValue);
          if (f) {
            this.$.kick.playbackRate = parseFloat(newValue);
            this.$.snare.playbackRate = parseFloat(newValue);
          }
        } catch (e) {}
      },
      stickcolorChanged: function (oldValue, newValue) {
        // this.$.stick.style.background = newValue;
      },
      drumcolorChanged: function (oldValue, newValue) {
        // this.$.drum.style.background = newValue;
      },
      backgroundcolorChanged: function (oldValue, newValue) {
        console.log("background change to " + newValue);
        this.$.wrapper.style.background = newValue;
      }
    });
  </script>
</polymer-element>

<polymer-element name="ceci-dataview" showdelete="true" showedit="true" attributes="showaddtoitem listschema showkey dataname datascope showedit showdelete" dataname="Items" extends="ceci-element" assetpath="component-dataview/">
  <template>
    <style>:host {
  display: block;
  width: 100%;
  box-sizing: border-box;
  padding: 10px;
  background: #EFEFEF;
  border-bottom: solid 3px #BBB;
}

:host h1 {
  font-size: 18px;
  border-bottom: solid 2px #CCC;
  margin-bottom: 10px;
  padding-bottom: 4px;
  text-shadow: 0px 1px 0px white;
}

:host .counter {
  line-height: 3.8rem;
  text-align: center;
  font-size: 1.6rem;
  font-family: "FiraSans", sans-serif;
  padding: .5rem 0rem;
  background: #0Da;
  color: #666;
}

:host #keys-wrapper h2 {
  color: #777;
  cursor: pointer;
  font-size: 15px;
  font-weight: normal;
  text-align: center;
  margin: 0;
}

:host #keys[show=no]{
  display: none;
}

:host #keys-wrapper {
  background: #DDD;
  -webkit-border-radius: 5px;
  border-bottom: solid 1px #BBB;
  padding: 5px 0 3px 0px;
  font-size: 15px;
  border-bottom: solid 1px #BBB;
}

:host #items {
  margin-top: 10px;
  text-align: center;
}

:host .keyConfig {
  margin: 0 0 2px 0;
  text-align: center;
  color: #777;
  font-size: 15px;
}

:host input {
  display: block;
  padding: 5px;
}

:host .dataGroup {
  padding: 5px 0;
  border: solid 1px #DDD;
  margin-bottom: 5px;
  background: white;
  padding: 5px;
  -webkit-border-radius: 3px;
}

:host .dataGroup .dataItem {
  padding: 5px 0;
  border-bottom: solid 1px #EFEFEF;
  font-size: 16px;
}

:host .dataGroup .dataItem:only-child {
  border: none;
}

:host .dataGroup img {
  max-width: 100%;
  display: block;
  margin: 0 auto;
  margin-bottom: 5px;
  box-shadow: 0 1px 3px rgba(0,0,0,.25);
}

:host .deleteItem, :host .editItem, :host .addToItem {
  display: inline-block;
  padding: 4px 10px !important;
  background: #BBB;
  color: white;
  margin: 8px 0px 3px 0px;
  margin-right: 5px;
  cursor: pointer;
  -webkit-border-radius: 3px;
}

:host .editItem {
  background: #358CCE;
}

:host .deleteItem {
  background: #999;
}

:host .addToItem {
  background: #84c147;
}

:host #datascope {
  text-align: center;
  padding-bottom: 5px;
}
</style>
    <div id="datascope"></div>
    <div id="keys-wrapper">
      <h2 on-click="{{toggleKeyConfig}}" id="configureView">Configure View</h2>
      <div id="keys" show="no"></div>
    </div>
    <div id="items"></div>
    <shadow></shadow>
    <script type="text/json" id="ceci-definition">

    </script>
  </template>
  <ceci-definition>
    {
      "thumbnail": "./thumbnail.png",
      "description": "Display any data you have created using forms made with addform component.",
      "broadcasts": {
        "editItem": {
          "label": "Send Item",
          "description": "Broadcasts a reference to the record when the 'Edit' button is tapped."
        },
        "addToItem": {
          "description": "Broadcasts a reference to the record when the 'Add to' button is tapped.",
          "label": "Add to Item"
        },
        "sendItem": {
          "description": "Broadcasts a reference to the record when it is tapped.",
          "label": "View Item"
        }
      },
      "listeners": {
        "showItem": {
          "description": "Shows the data for this record.",
          "label": "Show item"
        }
      },
      "attributes": {
        "dataname": {
          "description": "Will try to show this kind of item in the saved data, i.e. 'Cats'",
          "label": "I show...",
          "editable": "text"
        },
        "showdelete": {
          "description": "Hides or shows the delete icon for each record.",
          "label": "Show Delete Link",
          "editable": "boolean"
        },
        "showedit": {
          "description": "Show 'Edit' button",
          "label": "Hides or shows the Edit button for each record.",
          "editable": "boolean"
        },
        "showaddtoitem": {
          "description": "Show 'Add To' Button",
          "label": "Hides or shows the 'Add to This' button",
          "editable": "boolean"
        }
      }
    }
  </ceci-definition>
  <tags>data</tags>
  <script>
    Polymer("ceci-dataview", {
      keyConfig: {},
      storedData: {},
      dataChangedEvent: new CustomEvent("storage"),
      ready: function(){
        this.super();
        this.datascope = [];
        this.$.configureView.innerHTML = this.gettext(this.localName + "/configureView") || this.$.configureView.innerHTML;
      },
      toggleKeyConfig: function(){
        var keysEl = this.shadowRoot.querySelector("#keys");
        if(keysEl.getAttribute("show") == "no") {
          keysEl.setAttribute("show","yes");
        } else {
          keysEl.setAttribute("show","no");
        }
      },
      showdeleteChanged: function(oldValue,newValue){
        this.showData();
      },
      showaddtoitemChanged: function(oldValue,newValue){
        this.showData();
      },
      showeditChanged: function(oldValue,newValue){
        this.showData();
      },
      datanameChanged: function (oldValue, newValue) {
        this.updateKeyUI();
        this.showData();
      },
      showItem: function(e){
        this.datascope = e;
      },
      datascopeChanged: function(){
        // If we want to indicate the scope of the data that is shown, there is where we'd do it.
        // var scopeEl = this.shadowRoot.querySelector("#datascope");
        this.updateKeyUI();
        this.showData();
      },
      deleteItem: function(id){
        var self = this;
        var ca = document.querySelector("ceci-app");
        if(!ca){
          window.addEventListener("CeciDataConnectionLoaded", function(){
            self._deleteItemFirebase(id);
          });
        }
        else {
          if(ca.firebase){
            this._deleteItemFirebase(id);
          }
        }
      },
      _deleteItemFirebase: function(id){
        var self = this;
        var ca = document.querySelector("ceci-app")
        ca.getFirebaseObject('form-data', "", function(data){
          self.storedData = data || {};
          for (var i = 0; i < self.datascope.length; i++){
            var scopeItem = self.datascope[i];
            self.storedData = self.storedData[scopeItem["dataset"]][scopeItem["index"]];
          }
          self.storedData = self.storedData[self.dataname] || [];
          self.storedData.splice(id, 1);
          ca.setFirebaseObject('form-data', data);
          window.dispatchEvent(self.dataChangedEvent);
        });
      },
      updateKeyUI: function(){
        var self = this;
        var ca = document.querySelector("ceci-app");
        if(!ca){
          window.addEventListener("CeciDataConnectionLoaded", function(){
            self._updateKeyUIFirebase();
          })
        }
        else {
          if(ca.firebase){
            this._updateKeyUIFirebase();
          }
          else {
            window.addEventListener("CeciDataConnectionLoaded", function(){
              self._updateKeyUIFirebase();
            });
          }
        }
      },
      _updateKeyUIFirebase : function(){

        //This builds the UI that lets you choose how each key in the data set is displayed!
        var self = this;

        document.querySelector("ceci-app").getFirebaseObject('form-data',"", function(data){

          // Clears out the old UI
          self.shadowRoot.querySelector("#keys").innerHTML = "";

          // Tries to grab the stored Data
          var db = data || {};
          self.storedData = db[self.dataname] || [];

          // Tries to grab it's own keyConfig (which tells it how to render each Key field)
          self.keyConfig = JSON.parse(self.listschema) || {};

          // Grabs the schema from the form
          var formSchema = db[self.dataname + "_formschema"] || {};

          // Builds a list of all the keys from the form and data set
          // To know what to display options for.
          var keylist = [];
          for (var i = 0; i < self.storedData.length; i++){
            var item = self.storedData[i];
            for (var key in item) {
              if(keylist.indexOf(key) < 0) {
                keylist.push(key);
              }
            }
          }

          for (var j = 0; j < formSchema.length; j++){
            var item = formSchema[j];
            if(keylist.indexOf(item["name"]) < 0 ){
              keylist.push(item["name"]);
            }
          }

          for (var k = 0; k < keylist.length; k++){
            var key = keylist[k];
            if(!self.keyConfig[key]) {
              self.keyConfig[key] = "text";
            }
          }

          // CLean up the keyConfig file
          // Removes everything in the keyConfig that isn't in the keylist anymore.
          for (var key in self.keyConfig){
            if(keylist.indexOf(key) < 0) {
              delete self.keyConfig[key];
            }
          }

          // We should also clean up the key config.
          // we should also get rid of keys that are no longer needed from keyConfig
          // Like if something is NOT in the keylist, then dump it

          // Have a way to choose how each key is displayed

          for (var j = 0; j < keylist.length; j ++){
            var keyConfig = document.createElement("div");
            keyConfig.classList.add("keyConfig");
            keyConfig.innerHTML = "Show <strong>" + keylist[j] + "</strong> as ";

            var select =  document.createElement("select");
            keyConfig.appendChild(select);

            select.setAttribute("key",keylist[j]);
            select.innerHTML = "<option value='text'>text</option><option value='image'>image</option><option value='hide'>hide</option>";
            select.value = self.keyConfig[keylist[j]];

            select.addEventListener("change",function(e){
              self.keyConfig[e.target.getAttribute("key")] = e.target.value;
              self.showData();
              self.listschema = JSON.stringify(self.keyConfig);
            });
            self.shadowRoot.querySelector("#keys").appendChild(keyConfig);
          }

          //Put the list schema into the db
          db[self.dataname + "_listSchema"] = self.keyConfig;
          document.querySelector("ceci-app").setFirebaseObject('form-data', db);
          self.showData();
        });
      },
      enteredView : function(){
        var self = this;

        //Listens to updates to the data set
        window.addEventListener('storage', this.showData.bind(this), false);
        window.addEventListener('storage', this.updateKeyUI.bind(this), false);
        window.addEventListener('formChange', this.updateKeyUI.bind(this), false);

        this.updateKeyUI();

        //Show exising data
        this.showData();
        this.super();
      },
      getOrWaitForCeciApp: function(callback){
        var ceciApp = document.querySelector("ceci-app");
        if(!ceciApp){
          window.addEventListener("CeciDataConnectionLoaded", function(){
            callback(document.querySelector("ceci-app"));
          });
        } else {
          if(ceciApp && ceciApp.firebase){
            callback(ceciApp);
          } else {
            window.addEventListener("CeciDataConnectionLoaded", function(){
              callback(document.querySelector("ceci-app"));
            });
          }
        }
      },
      showData: function(){
        var self = this;
        this.getOrWaitForCeciApp(function(ceciApp){
          var that = self;
          ceciApp.getFirebaseObject('form-data', "", function(data){
          var those = that;
          those.storedData = data || {};

          //handle case where dataview is just loading and listSchema hasn't been parsed and
          //stored in keyConfig
          if(those.keyConfig && Object.getOwnPropertyNames(those.keyConfig).length < 1){
            those.keyConfig = those.storedData[those.dataname+"_listSchema"];
          }

          var lastData;
          for (var i = 0; i < those.datascope.length; i++){
            var scopeItem = those.datascope[i];
            self.storedData = those.storedData[scopeItem["dataset"]][scopeItem["index"]];
            lastData = scopeItem["dataset"];
          }

          if (lastData == those.dataname){
            var blam = [];
            blam.push(those.storedData);
            those.storedData = blam;
          }
          else {
            those.storedData = those.storedData[those.dataname] || [];
          }

          var itemList = those.shadowRoot.querySelector("#items");
          itemList.innerHTML = "";

          for(var i = 0; i < those.storedData.length; i++){
            var item = those.storedData[i];
            var itemEl = document.createElement("div");
            itemEl.classList.add("dataGroup");

            for (var key in item) {
              var displayType = those.keyConfig[key];
              var dataItem;

              if (displayType == "text") {
                dataItem = document.createElement("div");

                if (typeof item[key] == "object"){
                  dataItem.innerHTML = "List of " + item[key].length + " " + key;
                }
                else {
                  dataItem.innerHTML = item[key];
                }
              }
              else if (displayType == "image") {
                dataItem = document.createElement("img");
                dataItem.setAttribute("src", item[key]);
              }
              else {
                dataItem = document.createElement("div");
              }

              dataItem.classList.add("dataItem");

              var these = those;
              dataItem.addEventListener("click",function(e){
                var nodeList = Array.prototype.slice.call(e.currentTarget.parentNode.parentNode.children);
                var index = nodeList.indexOf(e.currentTarget.parentNode);
                var sendScope = JSON.parse(JSON.stringify(that.datascope));
                var scopeItem = {};
                scopeItem["dataset"] = these.dataname;
                scopeItem["index"] = index;
                sendScope.push(scopeItem);
                these.broadcast('sendItem', sendScope);
              });

              if(displayType != "hide") {
                itemEl.appendChild(dataItem);
              }
            }

            if(self.showedit == "true"){
              var editItem = document.createElement("div");
              editItem.innerHTML = "Edit";
              editItem.classList.add("editItem");
              itemEl.appendChild(editItem);
              editItem.addEventListener("click",function(e){
                var nodeList = Array.prototype.slice.call(e.currentTarget.parentNode.parentNode.children);
                var index = nodeList.indexOf( e.currentTarget.parentNode );
                var sendScope = JSON.parse(JSON.stringify(that.datascope));
                var scopeItem = {};
                scopeItem["dataset"] = these.dataname;
                scopeItem["index"] = index;
                sendScope.push(scopeItem);
                these.broadcast('editItem', sendScope);
              });
            }

            if(these.showaddtoitem == "true"){
              var el = document.createElement("div");
              el.innerHTML = "Add to self";
              el.classList.add("addToItem");
              itemEl.appendChild(el);
              el.addEventListener("click",function(e){
                var nodeList = Array.prototype.slice.call(e.currentTarget.parentNode.parentNode.children);
                var index = nodeList.indexOf( e.currentTarget.parentNode );
                var sendScope = JSON.parse(JSON.stringify(that.datascope));
                var scopeItem = {};
                scopeItem["dataset"] = these.dataname;
                scopeItem["index"] = index;
                sendScope.push(scopeItem);
                these.broadcast('addToItem', sendScope);
              });
            }

            if(self.showdelete == "true"){
              var deleteItem = document.createElement("div");
              deleteItem.innerHTML = "X";
              deleteItem.classList.add("deleteItem");
              itemEl.appendChild(deleteItem);
              deleteItem.addEventListener("click",function(e){
                var nodeList = Array.prototype.slice.call(e.currentTarget.parentNode.parentNode.children);
                var index = nodeList.indexOf( e.currentTarget.parentNode );
                these.deleteItem(index);
              });
            }

            itemList.appendChild(itemEl);
          }
          });
        });
      }
    });
  </script>
</polymer-element>

<polymer-element name="ceci-editform" extends="ceci-element" assetpath="component-editform/">
  <template>
    <style>:host {
  display: block;
  width: 100%;
  padding: 10px;
  box-sizing: border-box;
  background: #EFEFEF;
}

:host h1 {
  font-size: 18px;
  border-bottom: solid 2px #CCC;
  margin-bottom: 10px;
  padding-bottom: 4px;
  text-shadow: 0px 1px 0px white;
}

:host input {
  display: block;
  padding: 5px;
  width: 100%;
  font-size: 16px;
  margin-bottom: 4px;
  box-sizing: border-box;
}

:host p {
  color: white;
  background: green;
  cursor: pointer;
  padding: 5px 10px;
  display: inline-block;
}
</style>
    <div class="form">

    </div>
    <shadow></shadow>
  </template>
  <ceci-definition>
    {
      "thumbnail": "./thumbnail.png",
      "name": "Edit Form",
      "description": "Edits an item!",
      "listeners": {
        "editItem": {
          "description": "Set the item to edit with the form.",
          "label": "Set Edit Item"
        },
        "submitForm": {
          "description": "Submit this form.",
          "label": "Submit Form"
        }
      }
    }
  </ceci-definition>
  <script>
    Polymer("ceci-editform", {
      storedData : {},
      db: {},
      datascope: {},
      storedData: {},
      ready: function(){
        this.super();
      },
      editItem : function(scope){
        var self = this;
        var ca = document.querySelector("ceci-app");

        if(!ca){
          window.addEventListener("CeciDataConnectionLoaded", function(){
            self.editItemFirebase(scope);
          });
        } else {
          if(ca.firebase){
            this.editItemFirebase(scope);
          }
        }

      },
      editItemFirebase : function(scope){
        var self = this;

        document.querySelector("ceci-app").getFirebaseObject('form-data', "", function(data){

          self.db = data;
          self.datascope = scope;
          self.storedData = data || {};

          for (var i = 0; i < self.datascope.length; i++){
            var scopeItem = self.datascope[i];
            self.storedData = self.storedData[scopeItem["dataset"]][scopeItem["index"]];
          }

          var form = self.shadowRoot.querySelector(".form");
          form.innerHTML = "";

          for(key in self.storedData){
            if(typeof self.storedData[key] != "object"){

              var label = document.createElement("label");
              label.innerHTML = key;
              form.appendChild(label);

              var input = document.createElement("input");
              input.value = self.storedData[key];
              input.setAttribute("storeName",key);
              form.appendChild(input);
            }
          }

        });

      },
      submitForm : function(){
        // This resubmits the entire DB with the updated record
        var self = this;

        var newData = self.storedData;
        var fields = self.shadowRoot.querySelectorAll(".form input");

        self.storedData = self.db;

        for (var field in fields) {
          if (fields.hasOwnProperty(field)) {
            var f = fields[field];
            var name = f.getAttribute("storeName");
            var value = f.value;
            newData[name] = value;
          }
        }

        // Gets a reference to the correct item
        for (var i = 0; i < self.datascope.length; i++){
          var scopeItem = self.datascope[i];
          self.storedData = self.storedData[scopeItem["dataset"]][scopeItem["index"]];
        }

        // Replaces it with the new item
        self.storedData = newData;

        // Saves over the entire DB with the new item included
        var ca = document.querySelector("ceci-app");
        ca.setFirebaseObject('form-data', self.db);

        var event = new CustomEvent("storage");
        window.dispatchEvent(event);

      }
    });
  </script>
</polymer-element>

<polymer-element name="ceci-fireworks" attributes="fireworksound" extends="ceci-element" fireworksound="Kaboom!" assetpath="component-fireworks/">
  <template>
    <style>:host {
  display: block;
  background: black;
}

:host .app-fireworks {
  background-color: #0e1012;
  display: inline-block;
}

:host canvas {
  height: 100%;
  width: 100%;
}
</style>
    <div class="fireworks-wrapper">
      <canvas id="canvas" class="fireworks-canvas" on-click="{{click}}">Canvas is not supported in your browser.</canvas>
    </div>
    <shadow></shadow>
  </template>
  <ceci-definition>
      {
        "tags": ["animated", "starter", "fun"],
        "thumbnail": "./thumbnail.png",
        "description": "Shows firework show",
        "name": "Fireworks",
        "broadcasts": {
          "kaboom": {
            "label": "Kaboom",
            "description": "Occurs when a rocket explodes"
          }
        },
        "listeners": {
          "shootRocket": {
            "description": "Causes a rocket to launch",
            "label": "Shoot Rocket",
            "default": true
          },
          "shootThisManyRockets": {
            "description": "Shoot a number of rockets",
            "label": "Shoot This Many Rockets"
          }
        },
        "attributes": {
          "fireworksound": {
            "label": "Firework Sound",
            "description": "Tell the fireworks what to broadcast every shot.",
            "editable": "text",
            "listener": true
          }
        }
      }
    </ceci-definition>
  <script>
    Polymer('ceci-fireworks', {
      ready: function () {
        this.super();
        // when animating on canvas, it is best to use requestAnimationFrame instead of setTimeout or setInterval
        // not supported in all browsers though and sometimes needs a prefix, so we need a shim
        window.requestAnimFrame = ( function() {
          return window.requestAnimationFrame ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                function( callback ) {
                  window.setTimeout( callback, 1000 / 60 );
                };
        })();

        this.setAttribute('fireworksound', this.getAttribute("fireworksound") || 'Kapow!');

        // now we will setup our basic variables for the demo
        var canvas = this.$.canvas,
            ctx = canvas.getContext( '2d' ),

            // firework collection
            fireworks = [],
            // particle collection
            particles = [],
            // when launching fireworks with a click, too many get launched at once without a limiter, one launch per 5 loop ticks
            limiterTotal = 5,
            limiterTick = 0,
            mousedown = false,
            // mouse x coordinate,
            mx,
            // mouse y coordinate
            my;

        // starting hue
        this.hue = 120;
        // this will time the auto launches of fireworks, one launch per 80 loop ticks
        this.timerTotal = 80,
        this.timerTick = 0,

        this.ctx = ctx;

        // now we are going to setup our function placeholders for the entire demo

        // get a random number within a range
        function random( min, max ) {
          return Math.random() * ( max - min ) + min;
        }
        this.random = random;

        // calculate the distance between two points
        function calculateDistance( p1x, p1y, p2x, p2y ) {
          var xDistance = p1x - p2x,
              yDistance = p1y - p2y;
          return Math.sqrt( Math.pow( xDistance, 2 ) + Math.pow( yDistance, 2 ) );
        }

        var t = this;
        // create firework
        function Firework( sx, sy, tx, ty, hue ) {
          // actual coordinates
          this.x = sx;
          this.y = sy;
          // starting coordinates
          this.sx = sx;
          this.sy = sy;
          // target coordinates
          this.tx = tx;
          this.ty = ty;
          this.hue = hue;
          // distance from starting point to target
          this.distanceToTarget = calculateDistance( sx, sy, tx, ty );
          this.distanceTraveled = 0;
          // track the past coordinates of each firework to create a trail effect, increase the coordinate count to create more prominent trails
          this.coordinates = [];
          this.coordinateCount = 3;
          // populate initial coordinate collection with the current coordinates
          while( this.coordinateCount-- ) {
            this.coordinates.push( [ this.x, this.y ] );
          }
          this.angle = Math.atan2( ty - sy, tx - sx );
          this.speed = 2;
          this.acceleration = 1.05;
          this.brightness = random( 50, 70 );
        }
        // update firework
        Firework.prototype.update = function( index ) {
          // remove last item in coordinates array
          this.coordinates.pop();
          // add current coordinates to the start of the array
          this.coordinates.unshift( [ this.x, this.y ] );

          // speed up the firework
          this.speed *= this.acceleration;

          // get the current velocities based on angle and speed
          var vx = Math.cos( this.angle ) * this.speed,
              vy = Math.sin( this.angle ) * this.speed;
          // how far will the firework have traveled with velocities applied?
          this.distanceTraveled = calculateDistance( this.sx, this.sy, this.x + vx, this.y + vy );

          // if the distance traveled, including velocities, is greater than the initial distance to the target, then the target has been reached
          if( this.distanceTraveled >= this.distanceToTarget ) {
            t.broadcast('kaboom', t.getAttribute('fireworksound'));
            createParticles( this.tx, this.ty, this.hue );
            // remove the firework, use the index passed into the update function to determine which to remove
            fireworks.splice( index, 1 );
          } else {
            // target not reached, keep traveling
            this.x += vx;
            this.y += vy;
          }
        }
        // draw firework
        Firework.prototype.draw = function() {
          ctx.beginPath();
          // move to the last tracked coordinate in the set, then draw a line to the current x and y
          ctx.moveTo( this.coordinates[ this.coordinates.length - 1][ 0 ], this.coordinates[ this.coordinates.length - 1][ 1 ] );
          ctx.lineTo( this.x, this.y );
          ctx.strokeStyle = 'hsl(' + this.hue + ', 100%, ' + this.brightness + '%)';
          ctx.stroke();

          ctx.beginPath();
          // draw the target for this firework with a pulsing circle
          ctx.arc( this.tx, this.ty, this.targetRadius, 0, Math.PI * 2 );
        }
        // create particle
        function Particle( x, y, hue ) {
          this.x = x;
          this.y = y;
          // track the past coordinates of each particle to create a trail effect, increase the coordinate count to create more prominent trails
          this.coordinates = [];
          this.coordinateCount = 5;
          while( this.coordinateCount-- ) {
            this.coordinates.push( [ this.x, this.y ] );
          }
          // set a random angle in all possible directions, in radians
          this.angle = random( 0, Math.PI * 2 );
          this.speed = random( 1, 10 );
          // friction will slow the particle down
          this.friction = 0.95;
          // gravity will be applied and pull the particle down
          this.gravity = 1;
          // set the hue to a random number +-20 of the overall hue variable
          this.hue = random( hue - 20, hue + 20 );
          this.brightness = random( 50, 80 );
          this.alpha = 1;
          // set how fast the particle fades out
          this.decay = random( 0.015, 0.03 );
        }
        // update particle
        Particle.prototype.update = function( index ) {
          // remove last item in coordinates array
          this.coordinates.pop();
          // add current coordinates to the start of the array
          this.coordinates.unshift( [ this.x, this.y ] );
          // slow down the particle
          this.speed *= this.friction;
          // apply velocity
          this.x += Math.cos( this.angle ) * this.speed;
          this.y += Math.sin( this.angle ) * this.speed + this.gravity;
          // fade out the particle
          this.alpha -= this.decay;
          // remove the particle once the alpha is low enough, based on the passed in index
          if( this.alpha <= this.decay ) {
            particles.splice( index, 1 );
          }
        }
        // draw particle
        Particle.prototype.draw = function() {
          ctx.beginPath();
          // move to the last tracked coordinates in the set, then draw a line to the current x and y
          ctx.moveTo( this.coordinates[ this.coordinates.length - 1 ][ 0 ], this.coordinates[ this.coordinates.length - 1 ][ 1 ] );
          ctx.lineTo( this.x, this.y );
          ctx.strokeStyle = 'hsla(' + this.hue + ', 100%, ' + this.brightness + '%, ' + this.alpha + ')';
          ctx.stroke();
        }
        // create particle group/explosion
        function createParticles( x, y, hue ) {
          // increase the particle count for a bigger explosion, beware of the canvas performance hit with the increased particles though
          var particleCount = 30;
          while( particleCount-- ) {
            particles.push( new Particle( x, y, hue ) );
          }
        }
        this.Firework = Firework;
        this.Particle = Particle;
        this.fireworks = fireworks;
        this.particles = particles;

        (function loop() {
          // this function will run endlessly with requestAnimationFrame
          requestAnimFrame( loop );
          // increase the hue to get different colored fireworks over time
          t.hue += t.random(0,20)
          // normally, clearRect() would be used to clear the canvas
          // we want to create a trailing effect though
          // setting the composite operation to destination-out will allow us to clear the canvas at a specific opacity, rather than wiping it entirely
          t.ctx.globalCompositeOperation = 'destination-out';
          // decrease the alpha property to create more prominent trails
          t.ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
          t.ctx.fillRect( 0, 0, t.cw, t.ch );
          // change the composite operation back to our main mode
          // lighter creates bright highlight points as the fireworks and particles overlap each other
          t.ctx.globalCompositeOperation = 'lighter';
          // loop over each firework, draw it, update it
          var i = t.fireworks.length;
          while( i-- ) {
            t.fireworks[ i ].draw();
            t.fireworks[ i ].update( i );
          }
          // loop over each particle, draw it, update it
          var i = t.particles.length;
          while( i-- ) {
            t.particles[ i ].draw();
            t.particles[ i ].update( i );
          }
        })();

      },
      launchRocket: function() {
        this.fireworks.push( new this.Firework( this.cw / 2, this.ch,
        this.random( 0, this.cw ), this.random( 0, this.ch / 2 ), this.hue));
      },
      shootRocket: function (count, channel) {
        this.launchRocket();
      },
      shootThisManyRockets: function (count, channel) {
        var intRegex = /^\d+$/;
        if (intRegex.test(count)) {

          var n = Number(count);
          if (n > 15){
            n = 15;
          }
          for (var i=0; i < n; i++) {
            this.launchRocket();
          }
        } else {
          this.launchRocket();
        }
      },
      attached: function() {
        var rect = this.getBoundingClientRect();
        this.$.canvas.width = this.cw = rect.width;
        this.$.canvas.height = this.ch = rect.width;
        this.super();
      }
    });
  </script>
</polymer-element>


<polymer-element name="ceci-header" attributes="header" extends="ceci-element" header="Header" assetpath="component-header/">
  <ceci-definition>
    {
      "tags": ["starter", "layout", "navigation"],
      "thumbnail": "./thumbnail.png",
      "description": "A page header. You can send it a signal to navigate to that page.",
      "name": "Header",
      "broadcasts": {},
      "listeners": {
        "navigateHere": {
          "description": "navigateHere",
          "label": "Navigate Here"
        }
      },
      "attributes": {
        "header": {
          "label": "Header Label",
          "description": "Text for header label",
          "editable": "text",
          "listener": true
        }
      }
    }
  </ceci-definition>
  <template>
    <style>:host {
  display: block;
  width: 100%;
}

header {
  background-color: #212429;
  width: 100%;
  padding: 0;
  min-height: 5rem;
  line-height: 5rem;
  color: #FFF;
  font-size: 2.4rem;
  text-align: center;
}
</style>
    <header id="headerText"></header>
    <shadow></shadow>
  </template>
  <script>
    Polymer('ceci-header', {
      ready: function () {
        this.super();
      },
      headerChanged: function (oldValue, newValue) {
        this.$.headerText.innerHTML = newValue;
      },
      navigateHere: function () {
        var parent = this.parentNode;
        while (parent.nodeName !== "CECI-CARD") {
          parent = parent.parentNode;
        }
        if (parent) {
          parent.show();
        }
      }
    });
  </script>
</polymer-element>

<polymer-element name="ceci-hot-potato" extends="ceci-element" attributes="min max" min="10" max="15" assetpath="component-hot-potato/">
  <ceci-definition>
    {
      "name": "Hot Potato",
      "thumbnail": "./thumbnail.png",
      "description": "Generates a random number",
      "broadcasts": {
        "finish": {
          "label": "Game over",
          "description": "Sends a message that the game is over."
        }
      },
      "listeners": {
        "start": {
          "description": "Starts a new game.",
          "label": "New Game"
        }
      },
      "attributes": {
        "min": {
          "description": "",
          "label": "Min",
          "editable": "number"
        },
        "max": {
          "description": "",
          "label": "Max",
          "editable": "number"
        }
      }
    }
  </ceci-definition>
  <template>
    <style>:host {
  display: block;
  width: 100%;
}

:host .timer {
  font-family: "FiraSans", sans-serif;
  cursor: pointer;
  position: relative;
  text-decoration: none;
  outline: none;
  border-top: 1px solid rgba(255,255,255,.3);
  border-bottom: 2px solid rgba(0,0,0,.2);
  background-color: #4DB227;
  text-align: center;
  display: block;
  padding-top: 5px;
  padding-bottom: 3px;
  text-overflow: ellipsis;
  overflow: hidden;
  border-radius: 0.2rem;
  font-weight: 600;
  font-size: 1.8rem;
  line-height: 3.8rem;
  color: #ffffff;
  width: 100%;
  margin: 0;
}

:host button {
  border: none;
}


</style>
    <div class="timer">{{diffTime}}</div>
    <shadow></shadow>
  </template>
  <tags>starter,math</tags>
    <script>
      Polymer("ceci-hot-potato", {
        ready: function() {
          this.super();
          this.startTime = 0;
          this.randomTimeBetweenRange = 0;
          this.diffTime = 0;
        },
        start: function() {
          this.startTime = Date.now();
          var max = Number(this.max);
          var min = Number(this.min);
          this.randomTimeBetweenRange = Math.floor(Math.random() * (max - min + 1)) + min;
          this.timer();
        },
        timer: function() {
          var nowTime = Date.now();
          this.diffTime = ( nowTime - this.startTime ) / 1000;
          var that = this;
          if (this.diffTime >= this.randomTimeBetweenRange) {
            this.broadcast("finish", this.diffTime);
            return;
          }
          setTimeout(function() {
            that.timer();
          }, 200);
        }
      });
    </script>
</polymer-element>

<polymer-element name="ceci-image" source="http://www.placekitten.com/150/150" attributes="height source" extends="ceci-element" height="160" assetpath="component-image/">
  <template>
    <style>:host {
  display: block;
  text-align: center;
  width: 100%;
}

:host img {
  margin: 0;
  padding: 0;
  display: inline-block;
}

</style>
    <img id="image"><shadow></shadow>
  </template>
  <ceci-definition>
    {
      "tags": ["component-image", "view", "image"],
      "thumbnail": "./thumbnail.png",
      "name": "Image",
      "description": "Shows a simple image.",
      "broadcasts": {
        "click": {
          "label": "Click",
          "description": "Occurs when the image is clicked.",
          "default": false
        }
      },
      "listeners": {
        "setImageSource": {
          "description": "changes the image tags src attribute.",
          "label": "Set Image Source",
          "default": true
        }
      },
      "attributes": {
        "height": {
          "label": "Image Height",
          "description": "Image Height",
          "editable": "number",
          "listener": true
        },
        "source": {
          "label": "Image Source",
          "description": "The Image to Show",
          "editable": "text"
        }
      }
    }
  </ceci-definition>
  <script>
    Polymer('ceci-image', {
      ready: function () {
        this.super();

        var that = this;

        // User-configurable Properties
        // A component's user-configurable properties are stored as attributes.
        // Here they are set to a remembered value, or to a default starting.
        // The attribute name must match the name of the editable property in the 'editables' section.
        this.setAttribute("imageUrl", this.getAttribute("imageUrl") || "");
        this.img = this.$.image;
        this.img.style.height = this.getAttribute( "height" ) + "px";

        this.onclick = function () {
          that.broadcast("click", this.img.getAttribute( "src" ));
        };
        this.super();
      },
      setValue : function(v) {
        this.setImageSource(v);
      },
      sourceChanged : function(oldValue,newValue){
        this.setImageSource(this.source);
      },
      setImageSource : function (val) {
        this.source = val;
        this.img.setAttribute('src', val);
      },
      heightChanged: function( oldValue, newValue ) {
        this.img.style.height = ( newValue || newValue === 0 ? newValue : "160" ) + "px";
      }
    });
  </script>
</polymer-element>


<polymer-element name="ceci-snaredrum" attributes="source speed label value drumcolor backgroundcolor stickcolor" drumcolor="#FFFFFF" stickcolor="#000000" backgroundcolor="#ff9900" value="Click" extends="ceci-element" speed="1.0" assetpath="component-kickdrum/">
  <ceci-definition>
    {
      "tags": ["button", "click", "tap"],
      "thumbnail": "./thumbnail.png",
      "description": "Broadcasts a \"click\" when clicked.",
      "name": "Snare Drum",
      "broadcasts": {
        "click": {
          "label": "Click",
          "description": "Occurs when button is clicked."
        }
      },
      "listeners": {
        "kick": {
          "description": "Causes a fake click event to occur.",
          "label": "Kick",
          "default": true
        },
        "speed": {
          "description": "Sets the playback rate for the audio clip.",
          "label": "setSpeed"
        }
      },
      "attributes": {
        "speed": {
          "label": "Audio playback rate.",
          "description": "1 for normal speed, 2 for twice speed, -1 for reverse, etc.",
          "editable": "number"
        },
        "value": {
          "label": "Value",
          "description": "Value sent by the button.",
          "editable": "text"
        },
        "stickcolor": {
          "label": "Stick Color",
          "editable": "color"
        },
        "backgroundcolor": {
          "label": "Background Color",
          "editable": "color"
        },
        "drumcolor": {
          "label": "Drum Color",
          "description": "Color of the drum.",
          "editable": "color"
        }
      }
    }
  </ceci-definition>
  <template>
    <style>:host {
  display: block;
  width: 100%;
  background: orange;
}

:host #kick {
  height: 75px;
  display: block;
  cursor: pointer;
  overflow: hidden;
  width: 100%;
  position: relative;
}

:host #kick, :host #kick * {

}

:host #drum {
  height: 200px;
  width: 200px;
  background: white;
  position: absolute;
  left: calc(50% - 100px);
  border-radius: 150px;
  top: -20px;
  -webkit-transform: scaleY(.4);
}

:host #stick {
  height: 8px;
  width: 120px;
  background: black;
  position: absolute;
  left: 40px;
  top: 20px;
  border-radius: 100px;
  -webkit-transform-origin: left;
}

:host .hit #stick {
/*  -webkit-animation: stickhit .2s linear;*/
  top: 25px;
  -webkit-transform: rotate(15deg);
}

:host .hit #drum {
  top: -15px;
/*  -webkit-animation: drumhit .2s linear;*/
}

@-webkit-keyframes drumhit {
  0% { top: -20px;}
  20% { top: -20px;}
  30% { top: -15px;}
  100% { top: -20px;}
}



@-webkit-keyframes stickhit {
  0% { -webkit-transform: rotate(0deg);}
  20% { -webkit-transform: rotate(20deg);}
  100% { -webkit-transform: rotate(00deg);}
}

:host #kick.on {

}

:host audio {
  display: none;
}
</style>
    <div id="kick" class="off" on-mousedown="{{kickon}}" on-mouseup="{{kickoff}}">
      <div id="drum"></div>
      <div id="stick"></div>
    </div>
    <audio id="kicksound" src="component-kickdrum/sounds/snare.mp3" preload="preload"></audio>
    <shadow></shadow>
  </template>
  <script>
    Polymer('ceci-snaredrum', {
      ready: function () {
        this.super();
        var that = this;
      },
      kickon: function () {
        this.$.kicksound.pause();
        this.$.kicksound.currentTime = 0;
        this.$.kicksound.play();
        this.$.kick.classList.add("hit");
      },
      kick : function(){
        this.kickon();
        var that = this;
        window.setTimeout(function(){
          that.kickoff();
        },100)
      },
      kickoff : function(){
        this.$.kick.classList.remove("hit");
      },
      snare: function () {
        this.$.snare.pause();
        this.$.snare.currentTime = 0;
        this.$.snare.play();
      },
      sourceChanged: function(oldValue, newValue) {
        this.$.clip.src = newValue;
      },
      setSpeed: function(channel, value) {
        this.speedChanged(this.$.snare.playbackRate || 1, value);
        this.speedChanged(this.$.kick.playbackRate || 1, value);
      },
      speedChanged: function(oldValue, newValue) {
        try  {
          var f = parseFloat(newValue);
          if (f) {
            this.$.kick.playbackRate = parseFloat(newValue);
            this.$.snare.playbackRate = parseFloat(newValue);
          }
        } catch (e) {}
      },
      stickcolorChanged: function (oldValue, newValue) {
        this.$.stick.style.background = newValue;
      },
      drumcolorChanged: function (oldValue, newValue) {
        this.$.drum.style.background = newValue;
      },
      backgroundcolorChanged: function (oldValue, newValue) {
        this.$.kick.style.background = newValue;
      }
    });
  </script>
</polymer-element>

<polymer-element name="ceci-meatspaces-input" attributes="image text server mode" extends="ceci-element" assetpath="component-meatspaces-input/">
  <ceci-definition>
    {
      "tags": ["meatspaces", "input"],
      "thumbnail": "./thumbnail.png",
      "description": "Sends Meatspaces chat messages",
      "name": "Meat Chat Input",
      "listeners": {
        "send": {
          "label": "Send",
          "description": "Send message to chat server",
          "default": true
        }
      },
      "broadcasts": {
        "sent": {
          "label": "Message Sent",
          "description": "Message was sent to chat server"
        }
      },
      "attributes": {
        "image": {
          "label": "Image",
          "description": "Data-URL for image to be used",
          "listener": true
        },
        "server": {
          "label": "Server",
          "description": "URL for Appmaker Meatspaces Chat Server",
          "editable": "text"
        },
        "mode": {
          "label": "Message Mode",
          "description": "What kind of messages will be sent.",
          "editable": "select",
          "options": ["both", "text only", "image only"]
        }
      }
    }
  </ceci-definition>
  <template>
    <style>
      :host {
        display: block;
        width: 100%;
        min-height: 160px;
        position: relative;
      }

      :host img {
        width: 100px;
        height: 100px;
        float: left;
        margin-left: 5px;
        background-color: rgba(0, 0, 0, 0.2);
        display: block;
      }

      :host #container {
        padding: 5px 0;
      }

      :host #textarea-container {
        position: absolute;
        left: 110px;
        right: 10px;
        top: 5px;
        bottom: 10px;
      }

      :host textarea {
        width: 100%;
        height: 100%;
        resize: none;
      }

      :host #container[data-mode="text only"] img {
        display: none;
      }

      :host #container[data-mode="text only"] #textarea-container {
        left: 5px;
      }

      :host #container[data-mode="image only"] img {
        float: none;
        margin: 0 auto;
        width: 150px;
        height: 150px;
      }

      :host #container[data-mode="image only"] #textarea-container {
        display: none;
      }
    </style>
    <div id="container" data-mode="{{mode}}">
      <img src="{{image}}">
      <div id="textarea-container">
        <textarea placeholder="Type here">{{text}}</textarea>
      </div>
    </div>
    <shadow></shadow>
  </template>
  <script>
    Polymer('ceci-meatspaces-input', {
      text: '',
      image: 'data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==',
      server: 'http://appmaker-meatspaces-proxy.herokuapp.com/',
      mode: 'both',
      ready: function () {
        this.super();
      },
      send: function () {
        var payload = {
          image: this.image,
          text: this.text
        };
        var xhr = new XMLHttpRequest();
        xhr.open('POST', this.server + '/add/chat', true);
        xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
        xhr.onload = function (e) {
          console.log(xhr.response);
        };
        xhr.send(JSON.stringify(payload));
        this.text = '';
        this.image = 'data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==';
      }
    });
  </script>
</polymer-element>

<!--TODO-->
<!--1. stop event-->
<!--2. Does this evaluate true / false  this.getAttribute('autostart')-->
<!--3. support tap / touch event? touchend-->
<!--4. cancel-->

<polymer-element name="ceci-metronome" attributes="changeby beatsperminute autostart" beatsperminute="60" autostart="true" extends="ceci-element" label="Click Me" textcolor="#ffffff" changeby="1" buttoncolor="#4DB227" buttonactivecolor="#358915" assetpath="component-metronome/">
  <template>
    <style>:host {
  display: block;
  position: relative;
  padding: 10px 0;
  -webkit-user-select: none;
  -moz-user-select: none;
}

:host .metronome-wrapper {
  margin: 0 auto;
  position: relative;
}

:host .speed-control {
  height: 50px;
  width: 50px;
  background: #63a6cc;
  position: absolute;
  border-radius: 30px;
  -webkit-border-radius: 30px;
  top: 10px;
  cursor: pointer;
  opacity: .8;
}

:host .speed-control .icon {
  position: absolute;
  font-size: 40px;
  color: white;
  font-weight: bold;
  width: 100%;
  text-align: center;
  text-shadow: 0px -1px 0px rgba(0,0,0,.25);
}

:host .speed-control:hover {
  opacity: 1;
}

:host .speed-control.up {
  right: 40px;
}

:host .down .icon {
  top: -4px;
}

:host .speed-control.down {
  left: 40px;
}

:host .metronome-body {
  background: #85560b;
  border-top: solid 2px #85560b;
  background: -webkit-linear-gradient(top, #a87018,#85560b);
  background: -moz-linear-gradient(top, #a87018,#85560b);
  width: 40px;
  margin: 0 auto;
  padding: 8px 0 12px 0;
  -webkit-border-radius: 15px 15px 5px 5px;
  border-radius: 15px 15px 5px 5px;
  position: relative;
  cursor: pointer;
}

:host  .metronome-hole {
  background: white;
  height: 50px;
  width: 10px;
  margin: 0 auto;
  border-radius: 3px 3px 10px  10px;
  border-top: solid 2px #85560b;
  border-left: solid 1px #85560b;
  border-right: solid 1px #85560b;
}

:host  .metronome-shadow {
  background: #DDD;
  width: 50px;
  height: 20px;
  margin: 0 auto;
  -webkit-border-radius: 12px;
  -webkit-transform: scaleY(.5);
  border-radius: 12px;
  transform: scaleY(.5);
  border-radius: 12px;
  position: absolute;
  left: calc(50% - 25px);
  top: 62px;
}

:host .metronome-arrow {
  background: black;
  height: 45px;
  width: 6px;
  border: solid 2px white;
  -webkit-transform-origin: center 45px;
  -webkit-border-radius: 0 0 5px 5px;
  transform-origin: center 45px;
  border-radius: 0 0 5px 5px;
  position: absolute;
  top: 10px;
  left: 15px;
}

:host .metronome-animation {
  -webkit-animation-name: metronome;
  -webkit-animation-timing-function: linear;
  -webkit-animation-iteration-count: infinite;
  animation-name: metronome;
  animation-timing-function: linear;
  animation-iteration-count: infinite;
}

@-webkit-keyframes metronome {
  0% {-webkit-transform: rotate(0deg); }
  25% {-webkit-transform: rotate(-30deg); }
  50% {-webkit-transform: rotate(0deg); }
  75% {-webkit-transform: rotate(30deg); }
  100% {-webkit-transform: rotate(0deg); }
}

@keyframes metronome {
  0% {transform: rotate(0deg); }
  25% {transform: rotate(-30deg); }
  50% {transform: rotate(0deg); }
  75% {transform: rotate(30deg); }
  100% {transform: rotate(0deg); }
}
</style>
    <div class="metronome-wrapper">
      <div class="metronome-shadow"></div>
      <div class="metronome-body" on-click="{{click}}">
        <div class="metronome-hole"></div>
        <div class="metronome-arrow"></div>
      </div>
      <div class="speed-control up" on-click="{{faster}}">
        <span class="icon">+</span>
      </div>
      <div class="speed-control down" on-click="{{slower}}">
        <span class="icon">-</span>
      </div>
    </div>
    <shadow></shadow>
    <script type="text/json" id="ceci-definition"></script>
  </template>
  <ceci-definition>
    {
      "description": "Outputs ticks measured in Beats Per Minute (BPM)",
      "tags": ["fun","animated","starter"],
      "thumbnail": "./thumbnail.png",
      "name": "Metronome",
      "broadcasts": {
        "tick": {
          "label": "Tick",
          "description": "A tick of the metronome measured in Beats Per Minute(BPM)",
          "default": true
        }
      },
      "listeners": {
        "stop": {
          "description": "Stops metronome ticking.",
          "label": "Stop ticking"
        },
        "start": {
          "description": "Starts metronome ticking.",
          "label": "Start ticking"
        }
      },
      "attributes": {
        "beatsperminute": {
          "label": "Beats Per Minute (BPM)",
          "description": "Metronome ticks measured in beats per minute",
          "editable": "number",
          "min" : 0.1,
          "listener": true
        },
        "changeby" : {
          "label": "Button Increment",
          "description": "How much the + and - buttons change the speed by.",
          "editable": "number",
          "min" : 1,
          "listener": true
        },
        "autostart": {
          "label": "Autostart",
          "description": "Boolean value that controls if the metronome starts auto-playing when the component loads",
          "editable": "boolean",
          "listener": true
        }
      }
    }
  </ceci-definition>
  <script>
    Polymer('ceci-metronome', {
      ready: function () {
        this.super();
        this._count = 0;
        this._playing = false;
        this.timeout = null;
      },
      leftView: function () {
        clearTimeout(this.timeout);
      },
      setArrowSpeed: function (v) {
        var animDuration = v * 2;
        var metronomeArrow = this.shadowRoot.querySelector('.metronome-arrow');
        metronomeArrow.classList.remove("metronome-animation");
        if (v > 0 && this._playing) {
          metronomeArrow.offsetWidth = metronomeArrow.offsetWidth;
          metronomeArrow.classList.add("metronome-animation");
          metronomeArrow.style.webkitAnimationDuration = animDuration + "s";
          metronomeArrow.style.animationDuration = animDuration + "s";
        }
      },
      autostartChanged : function(){
        if(this.autostart == "true") {
          this.start();
        } else {
          this.stop();
        }
      },
      click: function() {
        if(this._playing){
          this.stop();
        } else {
          this.start();
        }
      },
      faster : function(){
        this.beatsperminute = parseInt(this.beatsperminute,10) + parseInt(this.changeby,10);
      },
      slower : function(){
        this.beatsperminute = parseInt(this.beatsperminute,10) - parseInt(this.changeby,10);
      },
      beatsperminuteChanged: function (oldValue, newValue) {
        if (newValue <= 0) {
          this.beatsperminute = 0.1;
        }
        this.setArrowSpeed((60 / this.beatsperminute));
      },
      start: function (oldValue, newValue) {
        this._playing = true;
        this.setArrowSpeed((60 / this.beatsperminute));
        this.tick();
      },
      stop: function () {
        this._playing = false;
        this.setArrowSpeed(0);
      },
      tick: function () {
        if (!this._playing) {
          return;
        }
        this._count++;
        this.broadcast('tick', this._count);
        var t = this;
        var defer = function () {
          t.tick();
        };
        this.timeout = setTimeout(defer, (60 / this.beatsperminute) * 1000);
      }
    });
  </script>
</polymer-element>

<polymer-element name="ceci-microphone-button" attributes="textcolor buttoncolor buttonactivecolor label" extends="ceci-element" label="Record" textcolor="#ffffff" buttoncolor="#4DB227" buttonactivecolor="#358915" assetpath="component-microphone-button/">
  <ceci-definition>
    {
      "tags": ["microphone", "button", "audio", "clip"],
      "thumbnail": "./thumbnail.png",
      "description": "Broadcasts an audio clip recorded using your microphone.",
      "name": "Microphone Button",
      "broadcasts": {
        "clip": {
          "label": "clip",
          "description": "An audio clip from your microphone.",
          "default": true
        }
      },
      "listeners": {
        "start": {
          "description": "Start a microphone recording.",
          "label": "start"
        },
        "stop": {
          "description": "Stop a microphone recording.",
          "label": "stop"
        }
      },
      "attributes": {
        "label": {
          "label": "Label",
          "description": "Text shown on the button.",
          "editable": "text",
          "listener": true
        },
        "textcolor": {
          "label": "Text Color",
          "description": "Color of the text on the button's label.",
          "editable": "color",
          "listener": true
        },
        "buttoncolor": {
          "label": "Button Color",
          "description": "Background color of the button.",
          "editable": "color",
          "listener": true
        },
        "buttonactivecolor": {
          "label": "Button Active Color",
          "description": "Background color of the button while it is being clicked or tapped.",
          "editable": "color",
          "listener": true
        }
      }
    }
  </ceci-definition>
  <template>
    <style>:host {
  display: block;
  width: 100%;
}

:host button {
  font-family: "FiraSans", sans-serif;
  cursor: pointer;
  position: relative;
  text-decoration: none;
  outline: none;
  border-top: 1px solid rgba(255,255,255,.3);
  border-bottom: 2px solid rgba(0,0,0,.2);
  background-color: #4DB227;
  text-align: center;
  display: block;
  padding-top: 5px;
  padding-bottom: 3px;
  text-overflow: ellipsis;
  overflow: hidden;
  border-radius: 0.2rem;
  font-weight: 600;
  font-size: 1.8rem;
  line-height: 3.8rem;
  color: #ffffff;
  width: 100%;
  margin: 0;
}

:host button {
  border: none;
}

</style>
    <button id="button" on-click="{{click}}">{{label}}</button>
    <shadow></shadow>
  </template>
  <script>
    Polymer('ceci-microphone-button', {
      ready: function () {
        this.super();
        var that = this;
        var mouseUpHandler = function(evt) {
          window.removeEventListener("mouseup", mouseUpHandler);
          that.$.button.style.backgroundColor = that.buttoncolor;
        };
        var mouseDownHandler = function(evt) {
          window.addEventListener("mouseup", mouseUpHandler);
          that.$.button.style.backgroundColor = that.buttonactivecolor;
        };
        this.$.button.addEventListener("mousedown", mouseDownHandler);
      },
      attached: function() {
        this.super();
        navigator.getMedia = ( navigator.getUserMedia ||
                               navigator.webkitGetUserMedia ||
                               navigator.mozGetUserMedia ||
                               navigator.msGetUserMedia );
        var that = this;
        var button = this.$.button;

        if (navigator.getMedia) {
          var audioCtx = new AudioContext();

          navigator.getMedia (
            {audio: true},

            function(stream) {
              console.log("good to go");

              var mediaRecorder = new MediaRecorder(stream);

              button.onmousedown = function() {
                console.log("starting recorder");
                mediaRecorder.start();
              };

              button.onmouseup = function() {
                console.log("stopping recorder");
                mediaRecorder.stop();
              };

              var processData = function(e) {
                console.log("data available after recording");
                var audioURL = window.URL.createObjectURL(e.data);
                that.broadcast('clip', audioURL);
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.ondataavailable = processData;
              };

              mediaRecorder.ondataavailable = processData;
            },

            function(err) { console.log('The following gUM error occured: ' + err); }
          );
        }
      },
      textcolorChanged: function (oldValue, newValue) {
        this.$.button.style.color = newValue;
      },
      buttoncolorChanged: function (oldValue, newValue) {
        this.$.button.style.backgroundColor = newValue;
      }
    });
  </script>
</polymer-element>

<polymer-element name="ceci-paypal" attributes="amount account currency" extends="ceci-element" currency="BRL" amount="5" account="donate@mozilla.org" button="false" assetpath="component-paypal/">
  <ceci-definition>
    {
      "name": "PayPal",
      "description": "Add your own PayPal donation buttons, and start raising funds.",
      "tags": ["paypal", "donate"],
      "thumbnail": "./thumbnail.png",
      "broadcasts": {
        "donate": {
          "label": "Donate",
          "description": "Occurs when donation process begins."
        }
      },
      "listeners": {
        "submit": {
          "description": "Submits a donation once settings have been chosen.",
          "label": "Submit",
          "default": "orange"
        }
      },
      "attributes": {
        "amount": {
          "label": "Amount",
          "description": "Amount of money to donate.",
          "editable": "number",
          "listener": true,
          "max": 3,
          "min": 50
        },
        "account": {
          "label": "Account",
          "description": "PayPal account which will receive payment.",
          "editable": "text"
        },
        "currency": {
          "label": "Currency",
          "description": "Currency code for donation amount.",
          "editable": "text"
        }
      }
    }
  </ceci-definition>
  <template>
    <style>:host {
  display: block;
  width: 100%;
}

:host img {
  width: 100%;
}

:host h3 {
  text-align: center;
}

:host #account {
  text-align: center;
}</style>
    <h3><span id="donationAmount">Donation Amount:</span> <span>{{amount}}</span> <span>{{currency}}</span></h3>
    <p id="account">{{account}}</p>
    <form id="form" method="post" action="https://www.paypal.com/cgi-bin/webscr">
      <input type="hidden" name="amount" id="pp_amount" value="{{amount}}">
      <input type="hidden" name="business" id="pp_business" value="{{account}}">
      <input type="hidden" name="currency_code" id="pp_currency_code" value="{{currency}}">
      <input type="hidden" name="item_name" id="fundrasingCampaignName" value="Donation from AppMaker App">
      <input type="hidden" name="no_shipping" value="1">
      <input type="hidden" name="rm" value="1">
      <input type="hidden" name="cmd" value="_donations"> <!-- TODO - could switch between donation and payments -->
      <input type="hidden" name="return" value=""> <!-- Return url is the current app url with query param to tell success -->
    </form>
    <img src="component-paypal/thumbnail.png">
    <shadow></shadow>
  </template>
  <script>
    Polymer('ceci-paypal', {
      ready: function () {
        this.super();
        this.$.donationAmount.innerHTML = this.gettext(this.localName + "/donationAmount") || this.$.donationAmount.innerHTML;
      },
      submit: function (value) {
        this.$.form.submit();
        this.broadcast('donate');
      }
    });
  </script>
</polymer-element>


<polymer-element name="ceci-random" extends="ceci-element" attributes="allowsame min max value" min="0" max="9" allowsame="false" assetpath="component-random-number/">
  <ceci-definition>
    {
      "name": "Random",
      "thumbnail": "./thumbnail.png",
      "description": "Generates a random number",
      "broadcasts": {
        "send": {
          "label": "Send random number",
          "description": "Sends the random number if explicitly asked to."
        },
        "changed": {
          "label": "Random number changed",
          "description": "Sends the newly generated number."
        }
      },
      "listeners": {
        "generate": {
          "description": "Generate a random number between min and max",
          "label": "Generates a random number"
        },
        "send": {
          "description": "Send the random number out",
          "label": "Send random number"
        }
      },
      "attributes": {
        "min": {
          "description": "",
          "label": "Min",
          "editable": "number"
        },

        "max": {
          "description": "",
          "label": "Max",
          "editable": "number"
        },
        "allowsame": {
          "description": "Allow same number twice",
          "label": "Allow same number twice",
          "editable": "boolean"
        }
      }
    }
  </ceci-definition>
  <template>
    <style>:host {
  display: block;
  width: 100%;
}

:host .counter {
  text-align: center;
  font-size: 14px;
  padding: 8px 0px;
  background: #DDD;
  color: #666;
}

:host .counter .count-wrapper {
  display: inline-block;
  background: white;
  padding: 5px 12px;
  border-radius: 5px;
  -webkit-border-radius: 5px;
  border: solid 1px #CCC;
  border-width: 1px 1px 2px 1px;
}
</style>
    <div class="counter">
        Random bewteen {{min}} and {{max}} &rarr;
      <div class="count-wrapper">
 {{value}}
      </div>
    </div>
    <shadow></shadow>
  </template>
  <tags>starter,math</tags>
    <script>
      Polymer("ceci-random", {
        ready: function() {
          this.value = Number(this.value) || 0;
          this.super();
        },
        value: 0,
        valueChanged: function() {
          this.broadcast("changed", this.value);
        },
        generate: function() {
          var max = Number(this.max);
          var min = Number(this.min);
          var random = Math.floor(Math.random() * (max - min + 1)) + min;

          if(this.allowsame == "false") {
            while(this.value == random){
              random = Math.floor(Math.random() * (max - min + 1)) + min;
            }
          }
          this.value = random;
        },
        send: function() {
          this.broadcast("send", this.value);
        }
      });
    </script>
</polymer-element>

<polymer-element name="ceci-sequencer" attributes="playbeats" extends="ceci-element" assetpath="component-sequencer/">
  <template>
    <style>:host {
  display: block;
  width: 100%;
  padding: 20px 10px 16px 10px;
  background: #555;
  text-align: center;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
}

:host .output-channel {
  padding: 5px 10px;
  background: #999;
  margin: 0 3px;
  display: block;
  border: solid 2px #555;
}

:host .beats {
  display: inline-block;
}

:host .next-up {
  background: white;
  border: solid 2px white;
  font-weight: bold;
}

:host #channels {
  display: inline-block;
  position: relative;
}



:host .channel {
  overflow: auto;
  margin-bottom: 4px;
}

:host .channel:last-child {
  margin-bottom: 0;
}

:host .channel .beat,
:host .channel .label
{
  display:block;
  float: left;
}

:host .channel .label:after {
  content: "1";
}

:host .channel .label {
  background: white;
  -webkit-border-radius: 30px;
  margin-right: 10px;
}

:host .channel .beat {
  background: #DDD;
  margin: 0;
  height: 40px;
  width: 68px;
  opacity: .2;
  margin: 0 4px 0px 0;
  -webkit-border-radius: 3px;
  position: relative;
}

:host .overlay {
  position: absolute;
  width: 100%;
  height: 100%;
  background: white;
  opacity: 0;
}

:host .channel .beat:last-child {
  margin-right: 0px;
}

:host .channel .beat:hover {
  opacity: .8;
}

:host [data-beat="0"] .beat:first-child,
:host [data-beat="1"] .beat:nth-child(2),
:host [data-beat="2"] .beat:nth-child(3),
:host [data-beat="3"] .beat:nth-child(4)
{
  opacity: .25;
}

:host [data-beat="0"] .beat.on:first-child,
:host [data-beat="1"] .beat.on:nth-child(2),
:host [data-beat="2"] .beat.on:nth-child(3),
:host [data-beat="3"] .beat.on:nth-child(4)
{
  opacity: 1;
}


:host .indicator.top {
  top: -8px;
}

:host .indicator {
  position: absolute;
  width: 68px;
  height: 5px;
  background: white;
  opacity: .4;
  -webkit-transform: scaleX(.2);
  -webkit-transform-origin: center;
}

:host .indicator.bottom {
  bottom: -8px;
}

:host [data-beat="0"] .indicator { left: 0px; }
:host [data-beat="1"] .indicator { left: 72px; }
:host [data-beat="2"] .indicator { left: 144px; }
:host [data-beat="3"] .indicator { left: 216px; }

:host .channel .beat.on {
  opacity: 1;
}

[data-color*="yellow"] .beat {
  background: rgba(229,210,0,1);
}

[data-color*="blue"] .beat {
  background: rgba(53,140,206,1);
}

[data-color*="red"] .beat {
  background: rgba(232,30,20,1);
}

[data-color*="pink"] .beat {
  background: rgba(255,84,167,1);
}

[data-color*="purple"] .beat {
  background: rgba(159,39,207,1);
}

[data-color*="green"] .beat {
  background: rgba(113,184,6,1);
}

[data-color*="orange"] .beat {
  background: rgba(255,123,0,1);
}</style>
    <div id="channels" data-beat="{{currentBeat}}">
      <div class="indicator top"></div>
      <div class="indicator bottom"></div>
      <template repeat="{{item, i in activebroadcasts}}">
        <div data-color="{{item.channelcolor}}" data-channel="{{item.channelname}}" class="channel">
            <div on-click="{{beattap}}" data-beat="1" class="beat"></div>
            <div on-click="{{beattap}}" data-beat="2" class="beat"></div>
            <div on-click="{{beattap}}" data-beat="3" class="beat"></div>
            <div on-click="{{beattap}}" data-beat="4" class="beat"></div>
        </div>
      </template>
    </div>
    <shadow></shadow>
  </template>
  <ceci-definition>
    {
      "tags": ["alternating-gate", "low-level"],
      "thumbnail": "./thumbnail.png",
      "name": "Sequencer",
      "description": "Alternates output between set broadcasts from a single input",
      "broadcasts": {
        "A": {
          "label": "Output A",
          "description": "The first broadcast in the rotation.",
          "default": "green"
        },
        "B": {
          "label": "Output B",
          "description": "The second broadcast in the rotation.",
          "default": "yellow"
        },
        "C": {
          "label": "Output C",
          "description": "The third broadcast in the rotation."
        },
        "D": {
          "label": "Output D",
          "description": "The fourth broadcast in the rotation."
        },
        "E": {
          "label": "Output E",
          "description": "The fifth broadcast in the rotation."
        }
      },
      "listeners": {
        "input": {
          "description": "The input that alternates out the broadcasts.",
          "label": "Input",
          "default": true
        }
      },
      "attributes": {

      }
    }
  </ceci-definition>
  <script>
    Polymer('ceci-sequencer', {
      nextBroadcast : "",
      beattap : function(e){
        var that = this;
        var beatEl = e.toElement;

        if(beatEl.classList.contains("on")){
          beatEl.classList.remove("on");
        } else {
          beatEl.classList.add("on");
        }

        that.playbeats = [[],[],[],[]];

        Array.prototype.forEach.call(this.shadowRoot.querySelectorAll(".channel"), function(chan) {
          var channel = chan.getAttribute("data-channel");
          var beat = 0;
          Array.prototype.forEach.call(chan.querySelectorAll(".beat"), function(beatEl) {
            if(beatEl.classList.contains("on")) {
              that.playbeats[beat].push(channel);
            }
              beat++;
          });
        });
        this.setAttribute("playbeats",JSON.stringify(this.playbeats));
      },
      currentBeat : 1,
      ready: function() {
        this.super();
        this.lastBroadcast = null;
        var self = this;
        this.playbeats = JSON.parse(this.getAttribute("playbeats")) || [[],[],[],[]];
      },
      colorSquares : function(){
        var that = this;
        for(var i = 0; i < this.playbeats.length; i++){
          var beatCount = i + 1;
          var beats = this.playbeats[i];
          for(var j = 0; j < beats.length; j++) {
            var channel = beats[j];
            this.shadowRoot.querySelector(".channel[data-channel="+channel+"] .beat:nth-child("+beatCount+")").classList.add("on");
          }
        }
      },
      attached : function(){
        this.super();
        var that = this;
        this.addEventListener("channelUpdated",function(){
          this.updateChannels();
        });
        this.updateChannels();
        this.async(function(){
          this.colorSquares()
        });
      },
      updateChannels: function(){
        var that = this;
        this.activebroadcasts = [];
        Array.prototype.forEach.call(this.querySelectorAll("ceci-broadcast"), function(broadcast) {
          var item = {};
          item.channelcolor = broadcast.getAttribute("on");
          item.channelname = broadcast.getAttribute("from");
          that.activebroadcasts.push(item);
        });
        this.async(function(){
          this.colorSquares()
        });

      },
      input: function(value) {
        this.currentBeat = this.currentBeat + 1;
        if(this.currentBeat > 3) {
          this.currentBeat = 0;
        }
        var playChannels = this.playbeats[parseInt(this.currentBeat)];
        for(var i = 0; i < playChannels.length; i++){
          this.broadcast(playChannels[i],"tick");
        }

      }
    });
  </script>
</polymer-element>

<polymer-element name="ceci-kickdrum" attributes="source speed label value textcolor buttoncolor buttonactivecolor" value="Click" extends="ceci-element" textcolor="#ffffff" buttoncolor="#4DB227" buttonactivecolor="#358915" speed="1.0" assetpath="component-snaredrum/">
  <ceci-definition>
    {
      "tags": ["button", "click", "tap"],
      "thumbnail": "./thumbnail.png",
      "description": "Broadcasts a \"click\" when clicked.",
      "name": "Kick Drum",
      "broadcasts": {},
      "listeners": {
        "kick": {
          "description": "Causes a fake click event to occur.",
          "label": "Kick",
          "default": true
        }
      },
      "attributes": {
      }
    }
  </ceci-definition>
  <template>
    <style>:host {
  display: block;
  width: 100%;
}

:host #kick {
  background: url(images/kick-off.png);
  height: 75px;
  display: block;
  cursor: pointer;
}
:host #kick.on {
  background: url(images/kick-on.png);
}

:host audio {
  display: none;
}
</style>
    <div id="kick" class="off" on-mousedown="{{kickon}}" on-mouseup="{{kickoff}}"></div>
    <audio id="kicksound" src="component-snaredrum/sounds/kick.mp3" preload="preload"></audio>
    <shadow></shadow>
  </template>
  <script>
    Polymer('ceci-kickdrum', {
      ready: function () {
        this.super();
        var that = this;
      },
      kickon: function () {
        this.$.kicksound.pause();
        this.$.kicksound.currentTime = 0;
        this.$.kicksound.play();
        this.$.kick.classList.add("on");
      },
      kick : function(){
        this.kickon();
        var that = this;
        window.setTimeout(function(){
          that.kickoff();
        },100)
      },
      kickoff : function(){
        this.$.kick.classList.remove("on");
      },
      snare: function () {
        this.$.snare.pause();
        this.$.snare.currentTime = 0;
        this.$.snare.play();
      },
      sourceChanged: function(oldValue, newValue) {
        this.$.clip.src = newValue;
      },
      setSpeed: function(channel, value) {
        this.speedChanged(this.$.snare.playbackRate || 1, value);
        this.speedChanged(this.$.kick.playbackRate || 1, value);
      },
      speedChanged: function(oldValue, newValue) {
        try  {
          var f = parseFloat(newValue);
          if (f) {
            this.$.kick.playbackRate = parseFloat(newValue);
            this.$.snare.playbackRate = parseFloat(newValue);
          }
        } catch (e) {}
      },
      textcolorChanged: function (oldValue, newValue) {
        this.$.button.style.color = newValue;
      },
      buttoncolorChanged: function (oldValue, newValue) {
        this.$.button.style.backgroundColor = newValue;
      }
    });
  </script>
</polymer-element>

<polymer-element name="ceci-spacer" attributes="height" extends="ceci-element" height="30" assetpath="component-spacer/">
  <template>
    <style>:host {
  display: block;
  width: 100%;
}
</style>
    <div id="spacerDiv"></div>
    <shadow></shadow>
  </template>
  <ceci-definition>
    {
      "tags": ["starter", "layout", "navigation"],
      "thumbnail": "./thumbnail.png",
      "name": "Spacer",
      "description": "A spacer to put between components.",
      "broadcasts": {},
      "listeners": {},
      "attributes": {
        "height": {
          "label": "Height",
          "description": "The height of the spacer.",
          "editable": "number",
          "listener": true
        }
      }
    }
  </ceci-definition>
  <script>
    Polymer('ceci-spacer', {
      ready: function () {
        this.super();
        this.setAttribute("height", this.height );
      },
      heightChanged: function (oldValue, newValue) {
        this.$.spacerDiv.style.height = newValue + "px";
      }
    });
  </script>
</polymer-element>

<polymer-element name="ceci-splitter" extends="ceci-element" assetpath="component-splitter/">
  <template>
    <style>:host, :host .splitter {
  display: block;
  width: 100%;
  height: 50px;
}

:host .splitter {
  background-color: black;
}
</style>
    <div class="splitter">
    </div>
    <shadow></shadow>
  </template>
  <ceci-definition>
    {
      "tags": ["component-splitter", "splitter"],
      "thumbnail": "./thumbnail.png",
      "description": "When a message passes through this component, it can send the message to multiple broadcasts.",
      "name": "Splitter",
      "broadcasts": {
        "splitter1": {
          "label": "splitter1",
          "description": "repeats input",
          "default": true
        },
        "splitter2": {
          "label": "splitter2",
          "description": "repeats input"
        },
        "splitter3": {
          "label": "splitter3",
          "description": "repeats input"
        },
        "splitter4": {
          "label": "splitter4",
          "description": "repeats input"
        },
        "splitter5": {
          "label": "splitter5",
          "description": "repeats input"
        },
        "splitter6": {
          "label": "splitter6",
          "description": "repeats input"
        }
      },
      "listeners": {
        "input": {
          "description": "input 1",
          "label": "Input",
          "default": true
        }
      },
      "attributes": {}
    }
  </ceci-definition>
  <script>
    Polymer('ceci-splitter', {
      ready: function () {
        this.super();
      },
      input: function(val) {
        this.broadcast("splitter1", val );
        this.broadcast("splitter2", val );
        this.broadcast("splitter3", val );
        this.broadcast("splitter4", val );
        this.broadcast("splitter5", val );
        this.broadcast("splitter6", val );
      }
    });
  </script>
</polymer-element>


<polymer-element name="ceci-text-input" attributes="inputname placeholdertext emitonchange label" extends="ceci-element" placeholdertext="Placeholder" inputname="Text Input" assetpath="component-text-input/">
  <ceci-definition>
    {
      "tags": ["input", "form"],
      "thumbnail": "./thumbnail.png",
      "name": "Text Input",
      "description": "A text input that broadcasts whatever a user types.",
      "broadcasts": {
        "sendData": {
          "label": "Send Data",
          "description": "Occurs when button is clicked or Enter key is pressed.",
          "default": true
        }
      },
      "listeners": {
        "click": {
          "description": "Causes a fake click event to occur.",
          "label": "Send Data"
        }
      },
      "attributes": {
        "inputname": {
          "label": "Input Name",
          "description": "The name of this field, helpful when saving data.",
          "editable": "text",
          "listener": true,
          "defaultListener": false
        },
        "placeholdertext": {
          "label": "Placeholder Text",
          "description": "The text you want your input field to show by default.",
          "editable": "text",
          "listener": true
        },
        "emitonchange": {
          "label": "Emit on change",
          "description": "Background color of the button while it is being clicked or tapped.",
          "editable": "boolean",
          "listener": true
        }
      }
    }
  </ceci-definition>
  <template>
    <style>:host {
  display: block;
  width: 100%;
  height: 50px;
}

ceci-text-input {
  padding: 0;
  height: 3.8rem;
}

ceci-text-input input[type=text]{
  padding: 0;
  height: 100%;
  border: none;
  color: #000;
  font-weight: 500;
  font-size: 1.6rem;
  background-color: #FFF;
  background-size: auto 100%;
  width: 70%;
  border-radius: 0;
  margin: 0;
  float: left;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  border: 0.1rem solid rgb(204, 204, 204);
  border-right: none;
  text-indent: 0.6rem;
  outline: none;
  font-weight: 400;
  font-size: 1.6rem;
  font-family: "FiraSans", sans-serif;
}

ceci-text-input.onchange input[type=text]{
  width: 100%;
}

ceci-text-input button {
  background: linear-gradient(to top, #f8f8f8, #ddd);
  background: -webkit-linear-gradient(top, #f8f8f8, #ddd);
  border: 0.1rem solid #a6a6a6;
  border-radius: 0 0.2rem 0.2rem 0;
  float: left;
  width: 30%;
  padding: 0;
  height: 100%;
  font-weight: 500;
  font-size: 1.6rem;
  font-family: "FiraSans", sans-serif;
}

ceci-text-input button:active {
  background: linear-gradient(to top, #ddd, #ddd);
  background: -webkit-linear-gradient(top, #ddd, #ddd);
}</style>
    <input id="inputText" type="text" on-input="{{input}}" on-keypress="{{keypress}}"><button id="button" on-click="{{submit}}"></button>
    <shadow></shadow>
  </template>
  <script>
    Polymer('ceci-text-input', {
      emitonchange:false,
      ready: function () {
        this.super();

        var that = this;
        this.$.button.innerHTML = this.gettext("ceci-text-input/button") || this.$.button.innerHTML;
      },
      submit: function () {
        this.broadcast('sendData', this.$.inputText.value);
        this.$.inputText.value = "";
      },
      input: function (e) {
        if (!this.emitonchange) {
          return;
        }
        this.broadcast('sendData', this.$.inputText.value);
      },
      keypress: function (e) {
        if (!this.emitonchange) {
          if (e.keyCode == 13) {
            this.broadcast('sendData', this.$.inputText.value);
            this.$.inputText.value = '';
          }
        }
      },
      emitonchangeChanged: function(oldValue, newValue) {
        this.classList.toggle('onchange');
        this.$.button.classList.toggle('hidden');
      },
      placeholdertextChanged: function(oldValue, newValue) {
        if (this.$.inputText.hasAttribute('placeholder')) {
          this.$.inputText.setAttribute("placeholder", newValue);
        }
        else {
          this.$.inputText.setAttribute("placeholder", newValue);
        }
      }
    });
  </script>
</polymer-element>


<polymer-element name="ceci-textbox" attributes="text" extends="ceci-element" text="I&apos;m a textbox!" assetpath="component-textbox/">
  <ceci-definition>
    {
      "tags": ["form", "input", "text"],
      "thumbnail": "./thumbnail.png",
      "description": "Listen for a message and updates text",
      "name": "Text",
      "broadcasts": {},
      "listeners": {
        "setValue": {
          "description": "Set value text box",
          "label": "Set Value"
        }
      },
      "attributes": {
        "text": {
          "label": "Text",
          "description": "A text for your label to show up in your app.",
          "editable": "text",
          "listener": true
        }
      }
    }
  </ceci-definition>
  <template>
    <style>:host {
  display: block;
  width: 100%;
  padding: 10px;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}

:host p {
  word-wrap: break-word;
  overflow: hidden;
  padding: 0;
  margin: 0;
  font-size: 15px;
  font-family: "FiraSans", sans-serif;
  font-weight: 500;
  line-height: auto;
}
</style>
    <p id="textBox"></p>
    <shadow></shadow>
  </template>
  <script>
    Polymer('ceci-textbox', {
      ready: function () {
        this.super();
      },
      setValue: function(e) {
        this.text = e;
      },
      textChanged: function (oldValue, newValue) {
        this.$.textBox.innerHTML = newValue;
      }
    });
  </script>
</polymer-element>

<polymer-element name="ceci-transformer" extends="ceci-element" attributes="message" assetpath="component-transformer/">
  <ceci-definition>
    {
      "name": "Transformer",
      "thumbnail": "./thumbnail.png",
      "description": "Listens for a message and sends out what the user specifies.",
      "broadcasts": {
        "transformedMessage": {
          "label": "Transformed Message",
          "description": "Broadcasts the current count."
        }
      },
      "listeners": {
        "incomingMessage": {
          "description": "Increment the total by the increment value",
          "label": "Incoming Message",
          "default" : true
        }
      },
      "attributes": {
        "message": {
          "description": "Transform received messaeg to this.",
          "label": "Message",
          "editable": "Text",
          "default" : true
        }
      }
    }
  </ceci-definition>
  <template>
    <style>:host {
  display: block;
  width: 100%;
}

:host .counter {
  text-align: center;
  font-size: 16px;
  padding: 8px 0px;
  background: #DDD;
  color: #666;
}

:host .counter .count-wrapper {
  display: inline-block;
  background: white;
  padding: 5px 12px;
  border-radius: 5px;
  -webkit-border-radius: 5px;
  border: solid 1px #CCC;
  border-width: 1px 1px 2px 1px;
}
</style>
    <div class="counter">
      <div class="count-wrapper">
        Transform to "<span class="count">{{message}}</span>"
      </div>
    </div>
    <shadow></shadow>
  </template>
  <tags>starter,math</tags>
    <script>
      Polymer("ceci-transformer", {
        ready: function() {
          this.super();
        },
        incomingMessage : function(){
          this.broadcast("transformedMessage", this.message);
        },
        message: 'Sprocket',
        unitChanged: function() {
          this.updateUnit();
        },
        resetCount: function() {
          this.value = 0;
        }
      });
    </script>
</polymer-element>


</body>
</html>
